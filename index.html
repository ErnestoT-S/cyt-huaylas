        // ==================== FUNCIONES DE EVALUACIÓN ====================
        
        function openRubricBuilder() {
            openModal('rubric-builder');
            document.getElementById('modalTitle').textContent = 'Constructor de Rúbricas';
            document.getElementById('modalBody').innerHTML = `
                <div style="margin-bottom: 1.5rem;">
                    <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">Paso 1: Selecciona la competencia</label>
                    <select id="rubricCompetencia" onchange="updateRubricPreview()" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 0.5rem;">
                        <option value="">-- Selecciona --</option>
                        <option value="indaga">Indaga mediante métodos científicos</option>
                        <option value="explica">Explica el mundo natural</option>
                        <option value="disena">Diseña y construye soluciones tecnológicas</option>
                        <option value="competencia">Competencias ciudadanas</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 1.5rem;">
                    <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">Paso 2: Selecciona el grado</label>
                    <select id="rubricGrado" onchange="updateRubricPreview()" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 0.5rem;">
                        <option value="">-- Selecciona --</option>
                        <option value="1">1° Secundaria</option>
                        <option value="2">2° Secundaria</option>
                        <option value="3">3° Secundaria</option>
                        <option value="4">4° Secundaria</option>
                        <option value="5">5° Secundaria</option>
                    </select>
                </div>
                
                <div id="rubricPreview" style="margin-bottom: 1.5rem; display: none;">
                    <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">Vista previa de la rúbrica:</label>
                    <div style="background: var(--bg); padding: 1rem; border-radius: 0.5rem; overflow-x: auto;">
                        <table style="width: 100%; font-size: 0.875rem; border-collapse: collapse;" id="rubricTable">
                            <!-- Se llena dinámicamente -->
                        </table>
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="generateRubricPDF()" style="width: 100%;" id="btnDownloadRubric" disabled>
                    <i class="fas fa-download"></i> Descargar rúbrica en PDF
                </button>
            `;
        }

        function updateRubricPreview() {
            const competencia = document.getElementById('rubricCompetencia').value;
            const grado = document.getElementById('rubricGrado').value;
            
            if (!competencia || !grado) {
                document.getElementById('rubricPreview').style.display = 'none';
                document.getElementById('btnDownloadRubric').disabled = true;
                return;
            }
            
            const rubricsData = {
                indaga: {
                    title: 'Indaga mediante métodos científicos',
                    criterios: [
                        ['Planteamiento del problema', 'No formula pregunta investigable', 'Formula pregunta muy amplia o poco clara', 'Formula pregunta investigable con variables identificadas'],
                        ['Hipótesis', 'No establece relación entre variables', 'Establece relación sin justificación', 'Establece relación causal con justificación basada en evidencia'],
                        ['Diseño experimental', 'Procedimiento confuso o inseguro', 'Procedimiento claro pero omite controles importantes', 'Procedimiento claro, seguro, con variables controladas y repeticiones'],
                        ['Análisis de datos', 'No organiza ni interpreta datos', 'Organiza datos pero interpretación superficial', 'Organiza datos en tablas/gráficos e interpreta patrones']
                    ]
                },
                explica: {
                    title: 'Explica el mundo natural',
                    criterios: [
                        ['Identificación de conceptos', 'No identifica conceptos relevantes', 'Identifica conceptos con imprecisiones', 'Identifica correctamente conceptos científicos pertinentes'],
                        ['Relación causa-efecto', 'No establece relaciones causales', 'Establece relaciones simples unidireccionales', 'Establece relaciones complejas considerando múltiples factores'],
                        ['Uso de evidencia', 'No usa evidencia para argumentar', 'Usa evidencia de manera parcial o poco relevante', 'Usa evidencia de múltiples fuentes de manera integrada']
                    ]
                },
                disena: {
                    title: 'Diseña y construye soluciones tecnológicas',
                    criterios: [
                        ['Identificación de necesidad', 'No identifica necesidad clara del contexto', 'Identifica necesidad pero poco relevante', 'Identifica necesidad real del contexto con diagnóstico'],
                        ['Propuesta de diseño', 'Diseño no viable o sin criterios', 'Diseño viable pero sin considerar sostenibilidad', 'Diseño viable, sostenible, con bocetos y lista de materiales'],
                        ['Construcción y prueba', 'No construye o prueba el prototipo', 'Construye pero sin registro de pruebas', 'Construye, prueba sistemáticamente y documenta resultados'],
                        ['Evaluación y mejora', 'No evalúa el funcionamiento', 'Evalúa cualitativamente sin propuestas de mejora', 'Evalúa con datos, identifica limitaciones y propone mejoras concretas']
                    ]
                }
            };
            
            const data = rubricsData[competencia] || rubricsData.indaga;
            const table = document.getElementById('rubricTable');
            
            table.innerHTML = `
                <tr style="background: var(--primary); color: white;">
                    <th style="padding: 0.75rem; text-align: left; border: 1px solid var(--border);">Criterio</th>
                    <th style="padding: 0.75rem; text-align: center; border: 1px solid var(--border); width: 25%;">Inicial</th>
                    <th style="padding: 0.75rem; text-align: center; border: 1px solid var(--border); width: 25%;">En proceso</th>
                    <th style="padding: 0.75rem; text-align: center; border: 1px solid var(--border); width: 25%;">Satisfactorio</th>
                </tr>
                ${data.criterios.map(crit => `
                    <tr>
                        <td style="padding: 0.75rem; border: 1px solid var(--border); font-weight: 600;">${crit[0]}</td>
                        <td style="padding: 0.75rem; border: 1px solid var(--border); font-size: 0.8rem;">${crit[1]}</td>
                        <td style="padding: 0.75rem; border: 1px solid var(--border); font-size: 0.8rem;">${crit[2]}</td>
                        <td style="padding: 0.75rem; border: 1px solid var(--border); font-size: 0.8rem; background: #f0fdf4;">${crit[3]}</td>
                    </tr>
                `).join('')}
            `;
            
            document.getElementById('rubricPreview').style.display = 'block';
            document.getElementById('btnDownloadRubric').disabled = false;
        }

        function generateRubricPDF() {
            const competencia = document.getElementById('rubricCompetencia');
            const grado = document.getElementById('rubricGrado');
            const competenciaText = competencia.options[competencia.selectedIndex].text;
            const gradoText = grado.options[grado.selectedIndex].text;
            
            alert(`Generando PDF de rúbrica:\n\nCompetencia: ${competenciaText}\nGrado: ${gradoText}\n\nEn una implementación real, esto descargaría un PDF listo para imprimir.`);
        }

        function openAlignmentChecker() {
            openModal('alignment-checker');
            document.getElementById('modalTitle').textContent = 'Verificador de Alineación';
            document.getElementById('modalBody').innerHTML = `
                <div style="margin-bottom: 1.5rem; padding: 1rem; background: #f0f9ff; border-radius: 0.5rem; border-left: 4px solid var(--primary);">
                    <p style="margin: 0; font-size: 0.95rem;"><strong>¿Qué verifica esta herramienta?</strong> Que tu evaluación mida realmente lo que se enseñó en clase. Evita la sorpresa de "evaluar lo que no se practicó".</p>
                </div>
                
                <div style="margin-bottom: 1.5rem;">
                    <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">1. Describe la actividad que realizaron los estudiantes:</label>
                    <textarea id="actividadInput" rows="3" placeholder="Ej: Los estudiantes diseñaron un sistema de riego con materiales reciclados..." style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 0.5rem;"></textarea>
                </div>
                
                <div style="margin-bottom: 1.5rem;">
                    <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">2. ¿Qué evidencia recolectaste?</label>
                    <textarea id="evidenciaInput" rows="2" placeholder="Ej: Fotos del prototipo, registro de pruebas, informe escrito..." style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 0.5rem;"></textarea>
                </div>
                
                <div style="margin-bottom: 1.5rem;">
                    <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">3. ¿Qué criterio de la rúbrica usaste?</label>
                    <select id="criterioInput" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 0.5rem;">
                        <option value="">-- Selecciona el criterio principal --</option>
                        <option value="diseno">Diseño de la propuesta tecnológica</option>
                        <option value="construccion">Construcción del prototipo</option>
                        <option value="prueba">Prueba y evaluación</option>
                        <option value="comunicacion">Comunicación de resultados</option>
                    </select>
                </div>
                
                <button class="btn btn-green" onclick="checkAlignment()" style="width: 100%;">
                    <i class="fas fa-search"></i> Verificar alineación
                </button>
                
                <div id="alignmentResult" style="margin-top: 1.5rem; display: none;"></div>
            `;
        }

        function checkAlignment() {
            const actividad = document.getElementById('actividadInput').value;
            const evidencia = document.getElementById('evidenciaInput').value;
            const criterio = document.getElementById('criterioInput').value;
            
            if (!actividad || !evidencia || !criterio) {
                alert('Por favor completa todos los campos');
                return;
            }
            
            const resultDiv = document.getElementById('alignmentResult');
            
            // Simulación de análisis
            const isAligned = actividad.toLowerCase().includes('diseñ') && criterio === 'diseno';
            
            if (isAligned) {
                resultDiv.innerHTML = `
                    <div style="background: #f0fdf4; padding: 1.5rem; border-radius: 0.75rem; border-left: 4px solid var(--secondary);">
                        <h4 style="color: var(--secondary); margin-bottom: 0.75rem;"><i class="fas fa-check-circle"></i> ¡Buena alineación detectada!</h4>
                        <p style="margin-bottom: 1rem;">Tu actividad, evidencia y criterio están coherentemente conectados.</p>
                        <div style="background: white; padding: 1rem; border-radius: 0.5rem;">
                            <p style="margin: 0; font-size: 0.9rem;"><strong>Recomendación:</strong> Asegúrate de que la evidencia (fotos, informes) realmente muestre el proceso de diseño, no solo el producto final.</p>
                        </div>
                    </div>
                `;
            } else {
                resultDiv.innerHTML = `
                    <div style="background: #fef2f2; padding: 1.5rem; border-radius: 0.75rem; border-left: 4px solid var(--danger);">
                        <h4 style="color: var(--danger); margin-bottom: 0.75rem;"><i class="fas fa-exclamation-triangle"></i> Posible desalineación detectada</h4>
                        <p style="margin-bottom: 1rem;">Parece que hay una discrepancia entre lo que se hizo y lo que se evalúa.</p>
                        <div style="background: white; padding: 1rem; border-radius: 0.5rem;">
                            <p style="margin: 0 0 0.5rem 0; font-size: 0.9rem;"><strong>Sugerencia:</strong></p>
                            <ul style="margin: 0; padding-left: 1.25rem; font-size: 0.9rem;">
                                <li>Si evalúas "diseño" pero la actividad fue solo construcción, ajusta el criterio</li>
                                <li>O si quieres evaluar diseño, asegúrate de que la actividad incluya bocetos y planificación</li>
                            </ul>
                        </div>
                    </div>
                `;
            }
            
            resultDiv.style.display = 'block';
        }

        function openEvidenceBank() {
            openModal('evidence-bank');
            document.getElementById('modalTitle').textContent = 'Banco de Evidencias';
            document.getElementById('modalBody').innerHTML = `
                <div style="display: grid; gap: 1rem;">
                    <div style="background: var(--bg); padding: 1rem; border-radius: 0.75rem; display: flex; gap: 1rem; align-items: start;">
                        <div style="width: 80px; height: 80px; background: #ddd; border-radius: 0.5rem; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <i class="fas fa-image" style="font-size: 1.5rem; color: var(--text-light);"></i>
                        </div>
                        <div style="flex: 1;">
                            <h4 style="margin-bottom: 0.25rem;">Cuaderno de campo - Indagación</h4>
                            <p style="font-size: 0.875rem; color: var(--text-light); margin-bottom: 0.5rem;">1° Secundaria • Hipótesis y registro de datos</p>
                            <div style="display: flex; gap: 0.5rem;">
                                <span class="feature-tag" style="background: #dcfce7; color: #166534;">Satisfactorio</span>
                                <button class="btn btn-small btn-outline" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">
                                    <i class="fas fa-eye"></i> Ver
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: var(--bg); padding: 1rem; border-radius: 0.75rem; display: flex; gap: 1rem; align-items: start;">
                        <div style="width: 80px; height: 80px; background: #ddd; border-radius: 0.5rem; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <i class="fas fa-file-pdf" style="font-size: 1.5rem; color: var(--text-light);"></i>
                        </div>
                        <div style="flex: 1;">
                            <h4 style="margin-bottom: 0.25rem;">Informe de diseño tecnológico</h4>
                            <p style="font-size: 0.875rem; color: var(--text-light); margin-bottom: 0.5rem;">2° Secundaria • Sistema de riego</p>
                            <div style="display: flex; gap: 0.5rem;">
                                <span class="feature-tag" style="background: #dbeafe; color: #1e40af;">En proceso</span>
                                <button class="btn btn-small btn-outline" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">
                                    <i class="fas fa-eye"></i> Ver
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: var(--bg); padding: 1rem; border-radius: 0.75rem; display: flex; gap: 1rem; align-items: start;">
                        <div style="width: 80px; height: 80px; background: #ddd; border-radius: 0.5rem; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <i class="fas fa-video" style="font-size: 1.5rem; color: var(--text-light);"></i>
                        </div>
                        <div style="flex: 1;">
                            <h4 style="margin-bottom: 0.25rem;">Video explicativo - Cadena alimentaria</h4>
                            <p style="font-size: 0.875rem; color: var(--text-light); margin-bottom: 0.5rem;">3° Secundaria • Explicación del mundo natural</p>
                            <div style="display: flex; gap: 0.5rem;">
                                <span class="feature-tag" style="background: #dcfce7; color: #166534;">Satisfactorio</span>
                                <button class="btn btn-small btn-outline" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">
                                    <i class="fas fa-play"></i> Ver
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 1.5rem; padding: 1rem; background: #fef3c7; border-radius: 0.5rem;">
                    <p style="margin: 0; font-size: 0.875rem;"><i class="fas fa-info-circle"></i> <strong>Nota:</strong> Estos son ejemplos ilustrativos. En una implementación completa, aquí se mostrarían evidencias reales anonimizadas de estudiantes.</p>
                </div>
            `;
        }

        function openFeedbackPhrases() {
            openModal('feedback-phrases');
            document.getElementById('modalTitle').textContent = 'Frases para Retroalimentar';
            document.getElementById('modalBody').innerHTML = `
                <div style="margin-bottom: 1rem;">
                    <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">Filtrar por nivel de desempeño:</label>
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <button class="filter-btn active" onclick="filterFeedback('inicial')">Inicial</button>
                        <button class="filter-btn" onclick="filterFeedback('proceso')">En proceso</button>
                        <button class="filter-btn" onclick="filterFeedback('satisfactorio')">Satisfactorio</button>
                    </div>
                </div>
                
                <div id="feedbackList" style="display: flex; flex-direction: column; gap: 0.75rem;">
                    <div class="feedback-item" style="background: var(--bg); padding: 1rem; border-radius: 0.5rem; border-left: 4px solid #dc2626;">
                        <p style="margin: 0 0 0.5rem 0; font-size: 0.95rem;">"Tu pregunta de investigación necesita ser más específica. Intenta incluir las variables que vas a estudiar."</p>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span class="feature-tag" style="font-size: 0.75rem;">Planteamiento del problema</span>
                            <button class="btn btn-small btn-outline" onclick="copyFeedback(this)" style="padding: 0.25rem 0.5rem;">
                                <i class="fas fa-copy"></i> Copiar
                            </button>
                        </div>
                    </div>
                    
                    <div class="feedback-item" style="background: var(--bg); padding: 1rem; border-radius: 0.5rem; border-left: 4px solid #dc2626;">
                        <p style="margin: 0 0 0.5rem 0; font-size: 0.95rem;">"Recuerda que una hipótesis debe relacionar dos variables: la que cambias y la que esperas que cambie."</p>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span class="feature-tag" style="font-size: 0.75rem;">Hipótesis</span>
                            <button class="btn btn-small btn-outline" onclick="copyFeedback(this)" style="padding: 0.25rem 0.5rem;">
                                <i class="fas fa-copy"></i> Copiar
                            </button>
                        </div>
                    </div>
                    
                    <div class="feedback-item" style="background: var(--bg); padding: 1rem; border-radius: 0.5rem; border-left: 4px solid #f59e0b;">
                        <p style="margin: 0 0 0.5rem 0; font-size: 0.95rem;">"Buen avance en tu diseño. Para mejorar, considera qué materiales de tu comunidad podrías usar en lugar de comprados."</p>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span class="feature-tag" style="font-size: 0.75rem;">Diseño tecnológico</span>
                            <button class="btn btn-small btn-outline" onclick="copyFeedback(this)" style="padding: 0.25rem 0.5rem;">
                                <i class="fas fa-copy"></i> Copiar
                            </button>
                        </div>
                    </div>
                    
                    <div class="feedback-item" style="background: var(--bg); padding: 1rem; border-radius: 0.5rem; border-left: 4px solid #059669;">
                        <p style="margin: 0 0 0.5rem 0; font-size: 0.95rem;">"Excelente trabajo identificando variables controladas. Tu experimento será confiable porque mantuviste constantes los factores que podrían afectar el resultado."</p>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span class="feature-tag" style="font-size: 0.75rem;">Diseño experimental</span>
                            <button class="btn btn-small btn-outline" onclick="copyFeedback(this)" style="padding: 0.25rem 0.5rem;">
                                <i class="fas fa-copy"></i> Copiar
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function filterFeedback(level) {
            // Simulación de filtro
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function copyFeedback(btn) {
            const text = btn.parentElement.previousElementSibling.textContent;
            navigator.clipboard.writeText(text).then(() => {
                btn.innerHTML = '<i class="fas fa-check"></i> Copiado';
                setTimeout(() => {
                    btn.innerHTML = '<i class="fas fa-copy"></i> Copiar';
                }, 2000);
            });
        }

        function downloadQuickRubric(type) {
            const rubricNames = {
                'indaga-1': 'Rúbrica_Indagacion_1Sec.pdf',
                'disena-2': 'Rúbrica_Diseno_2Sec.pdf',
                'explica-3': 'Rúbrica_Explicacion_3Sec.pdf',
                'ciudadana': 'Rúbrica_Ciudadana.pdf'
            };
            alert(`Descargando: ${rubricNames[type]}\n\nEn una implementación real, esto descargaría el PDF de la rúbrica.`);
        }
