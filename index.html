<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyT Huaylas - Portal Pedagógico</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #059669;
            --accent: #f59e0b;
            --danger: #dc2626;
            --purple: #7c3aed;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
            --text-light: #64748b;
            --border: #e2e8f0;
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white; padding: 1rem 0; position: sticky; top: 0; z-index: 100;
            box-shadow: var(--shadow-lg);
        }
        .header-content {
            max-width: 1200px; margin: 0 auto; padding: 0 1.5rem;
            display: flex; justify-content: space-between; align-items: center;
        }
        .logo { display: flex; align-items: center; gap: 0.75rem; font-weight: 700; font-size: 1.25rem; }
        .logo i { font-size: 1.5rem; color: var(--accent); }
        .nav-desktop { display: flex; gap: 2rem; }
        .nav-desktop a {
            color: rgba(255,255,255,0.9); text-decoration: none; font-weight: 500;
            font-size: 0.9rem; transition: color 0.2s; display: flex; align-items: center; gap: 0.5rem;
        }
        .nav-desktop a:hover, .nav-desktop a.active { color: white; }
        .mobile-menu-btn { display: none; background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer; }

        .hero {
            background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%);
            color: white; padding: 3rem 1.5rem; text-align: center;
        }
        .hero-content { max-width: 800px; margin: 0 auto; }
        .badge {
            display: inline-flex; align-items: center; gap: 0.5rem;
            background: rgba(255,255,255,0.15); padding: 0.5rem 1rem;
            border-radius: 9999px; font-size: 0.875rem; margin-bottom: 1.5rem; backdrop-filter: blur(10px);
        }
        .hero h1 { font-size: 2.5rem; font-weight: 700; margin-bottom: 1rem; line-height: 1.2; }
        .hero p { font-size: 1.125rem; opacity: 0.9; margin-bottom: 2rem; max-width: 600px; margin-left: auto; margin-right: auto; }
        .hero-actions { display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; }

        .btn {
            display: inline-flex; align-items: center; gap: 0.5rem;
            padding: 0.875rem 1.5rem; border-radius: 0.5rem; font-weight: 600;
            text-decoration: none; transition: all 0.2s; cursor: pointer; border: none; font-size: 0.95rem;
        }
        .btn-primary { background: white; color: var(--primary); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .btn-secondary { background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3); }
        .btn-secondary:hover { background: rgba(255,255,255,0.2); }
        .btn-small { padding: 0.5rem 1rem; font-size: 0.875rem; }
        .btn-outline {
            background: transparent; border: 2px solid var(--primary); color: var(--primary);
        }
        .btn-outline:hover { background: var(--primary); color: white; }
        .btn-purple { background: var(--purple); color: white; }
        .btn-purple:hover { background: #6d28d9; }
        .btn-green { background: var(--secondary); color: white; }
        .btn-green:hover { background: #047857; }

        .container { max-width: 1200px; margin: 0 auto; padding: 2rem 1.5rem; }

        .quick-access {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;
            margin: -2rem auto 3rem; max-width: 1000px; padding: 0 1.5rem;
            position: relative; z-index: 10;
        }
        .quick-card {
            background: var(--card); padding: 1.5rem; border-radius: 0.75rem;
            box-shadow: var(--shadow-lg); text-align: center; cursor: pointer;
            transition: all 0.3s; border: 2px solid transparent;
        }
        .quick-card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .quick-card i { font-size: 2rem; color: var(--primary); margin-bottom: 0.75rem; }
        .quick-card h3 { font-size: 1rem; margin-bottom: 0.25rem; }
        .quick-card p { font-size: 0.875rem; color: var(--text-light); }

        .section { margin-bottom: 4rem; }
        .section-header { text-align: center; margin-bottom: 2rem; }
        .section-header h2 { font-size: 2rem; color: var(--text); margin-bottom: 0.5rem; }
        .section-header p { color: var(--text-light); max-width: 600px; margin: 0 auto; }

        /* SECUENCIAS */
        .sequences-toolbar {
            background: var(--card); padding: 1.5rem; border-radius: 0.75rem;
            box-shadow: var(--shadow); margin-bottom: 1.5rem;
            display: flex; gap: 1rem; flex-wrap: wrap; align-items: center;
        }
        .search-box {
            flex: 1; min-width: 250px; position: relative;
        }
        .search-box input {
            width: 100%; padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 1px solid var(--border); border-radius: 0.5rem;
            font-size: 0.95rem; transition: all 0.2s;
        }
        .search-box input:focus {
            outline: none; border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        .search-box i {
            position: absolute; left: 0.875rem; top: 50%;
            transform: translateY(-50%); color: var(--text-light);
        }
        .filter-group { display: flex; gap: 0.5rem; flex-wrap: wrap; }
        .filter-btn {
            padding: 0.625rem 1rem; border: 1px solid var(--border);
            background: white; border-radius: 0.5rem; cursor: pointer;
            font-size: 0.875rem; transition: all 0.2s; display: flex; align-items: center; gap: 0.5rem;
        }
        .filter-btn:hover { border-color: var(--primary); }
        .filter-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        .results-count { font-size: 0.875rem; color: var(--text-light); margin-bottom: 1rem; }

        .cards-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 1.5rem;
        }
        .card {
            background: var(--card); border-radius: 1rem; overflow: hidden;
            box-shadow: var(--shadow); border: 1px solid var(--border);
            transition: all 0.3s; cursor: pointer; display: flex; flex-direction: column;
        }
        .card:hover { box-shadow: var(--shadow-xl); transform: translateY(-4px); }
        .card-image {
            height: 160px; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            display: flex; align-items: center; justify-content: center; position: relative;
        }
        .card-image i { font-size: 3rem; color: rgba(255,255,255,0.3); }
        .card-badge {
            position: absolute; top: 1rem; right: 1rem;
            background: rgba(255,255,255,0.95); padding: 0.375rem 0.75rem;
            border-radius: 9999px; font-size: 0.75rem; font-weight: 600;
            display: flex; align-items: center; gap: 0.25rem;
        }
        .card-header { padding: 1.25rem; border-bottom: 1px solid var(--border); }
        .card-tag {
            display: inline-flex; align-items: center; gap: 0.25rem;
            padding: 0.375rem 0.875rem; border-radius: 9999px;
            font-size: 0.75rem; font-weight: 600; text-transform: uppercase; margin-bottom: 0.75rem;
        }
        .tag-indagacion { background: #dbeafe; color: #1e40af; }
        .tag-evaluacion { background: #dcfce7; color: #166534; }
        .tag-tecnologia { background: #fef3c7; color: #92400e; }
        .tag-comunidad { background: #f3e8ff; color: #7c3aed; }
        .tag-diseno { background: #fce7f3; color: #9d174d; }
        
        .card h3 { font-size: 1.125rem; margin-bottom: 0.5rem; color: var(--text); line-height: 1.4; }
        .card p { color: var(--text-light); font-size: 0.9rem; line-height: 1.5; margin-bottom: 1rem; }
        .card-body { padding: 1.25rem; flex: 1; display: flex; flex-direction: column; }
        .card-meta {
            display: flex; gap: 1rem; font-size: 0.875rem; color: var(--text-light);
            margin-bottom: 1rem; flex-wrap: wrap;
        }
        .card-meta span { display: flex; align-items: center; gap: 0.25rem; }
        .card-footer {
            padding: 1rem 1.25rem; border-top: 1px solid var(--border);
            display: flex; gap: 0.5rem;
        }
        .card-footer .btn { flex: 1; justify-content: center; font-size: 0.875rem; padding: 0.625rem; }
        .card-features {
            display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap;
        }
        .feature-tag {
            background: var(--bg); padding: 0.25rem 0.5rem;
            border-radius: 0.375rem; font-size: 0.75rem;
            color: var(--text-light); display: flex; align-items: center; gap: 0.25rem;
        }

        /* GUÍAS MEJORADAS */
        .guides-tabs {
            display: flex; gap: 0.5rem; margin-bottom: 2rem; justify-content: center; flex-wrap: wrap;
        }
        .tab-btn {
            padding: 1rem 2rem; border: 2px solid var(--border); background: white;
            border-radius: 0.75rem; cursor: pointer; font-weight: 600;
            transition: all 0.3s; display: flex; align-items: center; gap: 0.75rem;
            font-size: 1rem;
        }
        .tab-btn:hover { border-color: var(--primary); transform: translateY(-2px); }
        .tab-btn.active {
            background: var(--primary); color: white; border-color: var(--primary);
            box-shadow: var(--shadow-lg);
        }
        .tab-btn.active .tab-icon { background: rgba(255,255,255,0.2); }
        .tab-icon {
            width: 40px; height: 40px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            background: var(--bg); font-size: 1.25rem;
        }
        
        .guide-content { display: none; }
        .guide-content.active { display: block; }
        
        .guide-intro {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            padding: 2rem; border-radius: 1rem; margin-bottom: 2rem;
            border-left: 4px solid var(--primary);
        }
        .guide-intro.diseno {
            background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
            border-left-color: var(--purple);
        }
        
        .steps-container {
            display: grid; gap: 1.5rem;
        }
        .step-card {
            background: var(--card); border-radius: 1rem; overflow: hidden;
            box-shadow: var(--shadow); border: 1px solid var(--border);
            transition: all 0.3s;
        }
        .step-card:hover { box-shadow: var(--shadow-lg); }
        .step-header {
            padding: 1.25rem; background: var(--bg);
            display: flex; align-items: center; gap: 1rem; cursor: pointer;
        }
        .step-number {
            width: 48px; height: 48px; background: var(--primary); color: white;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 1.25rem; flex-shrink: 0;
        }
        .step-card.diseno .step-number { background: var(--purple); }
        .step-title { flex: 1; }
        .step-title h3 { font-size: 1.125rem; margin-bottom: 0.25rem; }
        .step-title p { font-size: 0.875rem; color: var(--text-light); margin: 0; }
        .step-toggle { color: var(--text-light); transition: transform 0.3s; }
        .step-card.expanded .step-toggle { transform: rotate(180deg); }
        
        .step-content {
            max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out;
        }
        .step-card.expanded .step-content { max-height: 2000px; }
        .step-body { padding: 0 1.25rem 1.25rem; }
        
        .step-section { margin-bottom: 1.5rem; }
        .step-section h4 {
            font-size: 0.875rem; text-transform: uppercase; color: var(--text-light);
            margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;
        }
        
        .example-box {
            background: #fefce8; border: 1px solid #fde047; border-radius: 0.75rem;
            padding: 1rem; margin-bottom: 1rem;
        }
        .example-box.good { background: #f0fdf4; border-color: #86efac; }
        .example-box.bad { background: #fef2f2; border-color: #fca5a5; }
        .example-box strong {
            display: block; margin-bottom: 0.5rem; font-size: 0.875rem;
        }
        .example-box.good strong { color: var(--secondary); }
        .example-box.bad strong { color: var(--danger); }
        
        .tools-box {
            background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 0.75rem;
            padding: 1rem;
        }
        .tools-box h4 { color: var(--primary); margin-bottom: 0.75rem; }
        .tools-box ul { margin-left: 1.25rem; }
        .tools-box li { margin-bottom: 0.5rem; }
        
        .checklist {
            list-style: none; margin: 0;
        }
        .checklist li {
            display: flex; align-items: start; gap: 0.75rem;
            padding: 0.75rem; background: var(--bg); border-radius: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .checklist li i { color: var(--secondary); margin-top: 0.125rem; }
        
        .template-download {
            display: flex; align-items: center; gap: 1rem;
            padding: 1.25rem; background: var(--bg); border-radius: 0.75rem;
            margin-top: 1rem;
        }
        .template-icon {
            width: 56px; height: 56px; background: white;
            border-radius: 0.75rem; display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; color: var(--primary); box-shadow: var(--shadow);
        }
        .template-info { flex: 1; }
        .template-info h4 { margin-bottom: 0.25rem; }
        .template-info p { font-size: 0.875rem; color: var(--text-light); margin: 0; }

        .tools-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; }
        .tool-card {
            background: var(--card); border: 2px solid var(--border);
            border-radius: 0.75rem; padding: 1.5rem; transition: all 0.3s;
        }
        .tool-card:hover { border-color: var(--primary); transform: translateY(-2px); }
        .tool-icon {
            width: 48px; height: 48px; background: var(--bg);
            border-radius: 0.75rem; display: flex; align-items: center; justify-content: center;
            margin-bottom: 1rem; color: var(--primary); font-size: 1.25rem;
        }
        .tool-card h3 { font-size: 1.1rem; margin-bottom: 0.5rem; }
        .tool-card p { font-size: 0.9rem; color: var(--text-light); margin-bottom: 1rem; }

        .community-preview {
            background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%);
            border: 2px solid #bbf7d0; border-radius: 1rem; padding: 2rem;
        }
        .discussion-list { display: flex; flex-direction: column; gap: 1rem; margin-top: 1.5rem; }
        .discussion-item {
            background: white; padding: 1.25rem; border-radius: 0.5rem;
            border-left: 4px solid var(--secondary); display: flex; gap: 1rem; align-items: start;
            cursor: pointer; transition: all 0.2s;
        }
        .discussion-item:hover { box-shadow: var(--shadow); }
        .discussion-item.pending { border-left-color: var(--accent); }
        .discussion-avatar {
            width: 40px; height: 40px; background: var(--secondary); color: white;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-weight: 600; flex-shrink: 0;
        }
        .discussion-avatar.pending { background: var(--accent); }
        .discussion-content h4 { font-size: 0.95rem; margin-bottom: 0.25rem; }
        .discussion-content p { font-size: 0.875rem; color: var(--text-light); margin-bottom: 0.5rem; }
        .discussion-meta { font-size: 0.8rem; color: var(--text-light); display: flex; gap: 1rem; flex-wrap: wrap; }

        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center; padding: 1rem;
            overflow-y: auto;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: white; border-radius: 1rem; max-width: 800px; width: 100%;
            max-height: 90vh; overflow-y: auto; position: relative; margin: auto;
        }
        .modal-header {
            padding: 1.5rem; border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center; background: var(--bg);
        }
        .modal-body { padding: 1.5rem; }
        .close-btn {
            background: none; border: none; font-size: 1.5rem; cursor: pointer;
            color: var(--text-light); width: 32px; height: 32px;
            display: flex; align-items: center; justify-content: center; border-radius: 0.5rem;
        }
        .close-btn:hover { background: var(--border); color: var(--text); }

        .loading { display: inline-block; width: 20px; height: 20px; border: 3px solid #f3f3f3; border-top: 3px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .mobile-nav {
            display: none; position: fixed; bottom: 0; left: 0; right: 0;
            background: white; padding: 0.75rem; box-shadow: 0 -4px 6px -1px rgba(0,0,0,0.1);
            z-index: 100; justify-content: space-around;
        }
        .mobile-nav a {
            display: flex; flex-direction: column; align-items: center; gap: 0.25rem;
            color: var(--text-light); text-decoration: none; font-size: 0.75rem; padding: 0.5rem;
        }
        .mobile-nav a.active { color: var(--primary); }
        .mobile-nav i { font-size: 1.25rem; }

        /* ====== ESTILOS SECCIÓN EVALUACIÓN MEJORADA ====== */
        .eval-tabs {
            display: flex; gap: 0.5rem; margin-bottom: 2rem; justify-content: center; flex-wrap: wrap;
            border-bottom: 2px solid var(--border); padding-bottom: 10px;
        }
        .eval-tab-btn {
            padding: 0.875rem 1.5rem; border: 2px solid var(--border); background: white;
            border-radius: 0.5rem; cursor: pointer; font-weight: 600;
            transition: all 0.3s; display: flex; align-items: center; gap: 0.5rem;
            font-size: 0.95rem;
        }
        .eval-tab-btn:hover { border-color: var(--primary); transform: translateY(-2px); }
        .eval-tab-btn.active {
            background: var(--primary); color: white; border-color: var(--primary);
            box-shadow: var(--shadow-lg);
        }
        
        .eval-content { display: none; animation: fadeIn 0.4s; }
        .eval-content.active { display: block; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .rubrica-table-container {
            overflow-x: auto; margin-bottom: 2rem;
            box-shadow: var(--shadow-lg); border-radius: 0.75rem;
            background: white;
        }
        .rubrica-table {
            width: 100%; border-collapse: collapse; font-size: 0.9rem;
        }
        .rubrica-table th {
            background: var(--primary); color: white; padding: 1rem;
            text-align: left; font-weight: 600;
        }
        .rubrica-table td {
            padding: 0.875rem; border-bottom: 1px solid var(--border);
            vertical-align: top;
        }
        .rubrica-table tr:nth-child(even) { background: #f8fafc; }
        .rubrica-table tr:hover { background: #f1f5f9; }
        .criterio {
            background: #eff6ff !important; font-weight: 600; color: var(--primary-dark);
            width: 18%;
        }
        
        .calc-box {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            padding: 1.5rem; border-radius: 0.75rem;
            border: 2px solid #86efac; margin-top: 1.5rem;
        }
        .calc-row {
            display: flex; gap: 1rem; flex-wrap: wrap; margin: 1rem 0;
        }
        .calc-row label {
            display: flex; flex-direction: column; gap: 0.25rem;
            font-weight: 600; font-size: 0.875rem;
        }
        .calc-row select {
            padding: 0.5rem; border-radius: 0.375rem; border: 1px solid var(--border);
            width: 100px;
        }
        .resultado-final {
            font-size: 1.5rem; font-weight: bold; color: var(--secondary);
            text-align: center; margin-top: 1rem;
            padding: 0.75rem; background: white; border-radius: 0.5rem;
            display: inline-block;
        }
        
        .rubrica-cards {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        .rubrica-card {
            background: white; border: 2px solid var(--border);
            border-radius: 0.75rem; overflow: hidden;
            transition: all 0.3s;
        }
        .rubrica-card:hover {
            transform: translateY(-3px); box-shadow: var(--shadow-lg);
            border-color: var(--purple);
        }
        .rubrica-card-header {
            background: var(--purple); color: white;
            padding: 1rem; display: flex; justify-content: space-between; align-items: center;
        }
        .rubrica-card-header h4 { margin: 0; font-size: 1rem; }
        .peso {
            background: rgba(255,255,255,0.2); padding: 0.25rem 0.75rem;
            border-radius: 9999px; font-size: 0.875rem;
        }
        .niveles { list-style: none; padding: 0; margin: 0; }
        .niveles li {
            padding: 0.875rem; border-bottom: 1px solid var(--border);
            font-size: 0.9rem; line-height: 1.5;
        }
        .niveles li:last-child { border-bottom: none; }
        .niveles li strong { color: var(--purple); }
        
        .auto-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;
        }
        .auto-box {
            background: white; padding: 1.5rem;
            border-radius: 0.75rem; border: 2px solid var(--border);
            border-left: 4px solid var(--secondary);
        }
        .auto-box h4 {
            color: var(--secondary); margin-top: 0; margin-bottom: 1rem;
            font-size: 1.125rem;
        }
        .checklist-eval {
            display: flex; flex-direction: column; gap: 0.75rem;
        }
        .check-item {
            display: flex; align-items: flex-start; gap: 0.75rem;
            cursor: pointer; font-size: 0.95rem; line-height: 1.4;
        }
        .check-item input[type="checkbox"] {
            width: 18px; height: 18px; margin-top: 2px;
            cursor: pointer; accent-color: var(--secondary);
        }
        .reflexion-box {
            grid-column: 1 / -1; background: #fffbeb;
            padding: 1.5rem; border-radius: 0.75rem;
            border: 2px solid #fcd34d;
        }
        .reflexion-box h4 { color: #d97706; margin-top: 0; }
        .input-group { margin-bottom: 1rem; }
        .input-group label {
            display: block; font-weight: 600; margin-bottom: 0.5rem;
            color: var(--text); font-size: 0.9rem;
        }
        .input-group textarea {
            width: 100%; min-height: 80px; padding: 0.75rem;
            border: 1px solid var(--border); border-radius: 0.5rem;
            font-family: inherit; resize: vertical;
        }
        
        .feedback-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;
        }
        .feedback-card {
            background: white; border-radius: 0.75rem;
            padding: 1.5rem; border: 2px solid var(--border);
        }
        .feedback-card h4 {
            margin-top: 0; margin-bottom: 1rem;
            color: var(--text); border-bottom: 2px solid var(--border);
            padding-bottom: 0.5rem;
        }
        .ejemplo { margin-bottom: 1rem; }
        .ejemplo .tag {
            font-size: 0.75rem; font-weight: bold; color: var(--text-light);
            text-transform: uppercase; letter-spacing: 0.5px;
        }
        .ejemplo .mal {
            color: var(--danger); text-decoration: line-through;
            margin: 0.25rem 0; font-style: italic;
        }
        .ejemplo .bien {
            color: var(--secondary); font-weight: 600;
            margin: 0.25rem 0;
        }
        .tecnica-card { background: #eff6ff; border-color: #bfdbfe; }
        .tecnica-card h4 { color: var(--primary); border-color: #bfdbfe; }
        .tecnica-card ol { padding-left: 1.25rem; }
        .tecnica-card li { margin-bottom: 0.75rem; line-height: 1.5; }
        
        .phrases-card { background: #faf5ff; border-color: #e9d5ff; }
        .phrases-card h4 { color: var(--purple); border-color: #e9d5ff; }
        .phrases-card ul { list-style: none; padding: 0; }
        .phrases-card li {
            padding: 0.5rem 0; border-bottom: 1px dashed #e9d5ff;
            font-size: 0.95rem;
        }
        .phrases-card li:last-child { border-bottom: none; }
        .phrases-card em { color: var(--purple); font-weight: 600; }
        
        .registro-card { background: #fffbeb; border-color: #fcd34d; }
        .registro-card h4 { color: #d97706; border-color: #fcd34d; }
        .quick-form {
            border: 2px dashed var(--border); padding: 1rem;
            border-radius: 0.5rem; background: white;
        }
        .form-row {
            display: flex; justify-content: space-between; margin-bottom: 0.75rem;
            font-size: 0.875rem; color: var(--text-light);
        }
        .obs-line {
            border-bottom: 1px solid var(--border); height: 2rem; margin-bottom: 0.5rem;
        }
        .check-tipo {
            display: flex; gap: 1rem; margin-top: 0.75rem;
            font-size: 0.875rem; flex-wrap: wrap;
        }
        .check-tipo label { display: flex; align-items: center; gap: 0.25rem; }
        
        .download-eval-box {
            margin-top: 2rem; text-align: center;
            padding: 2rem; background: var(--bg); border-radius: 0.75rem;
        }
        .btn-download {
            background: var(--primary); color: white; border: none;
            padding: 0.75rem 1.5rem; margin: 0.25rem;
            border-radius: 0.5rem; cursor: pointer;
            transition: all 0.2s; font-weight: 600;
        }
        .btn-download:hover { background: var(--primary-dark); transform: translateY(-2px); }

        @media (max-width: 768px) {
            .nav-desktop { display: none; }
            .mobile-menu-btn { display: block; }
            .hero h1 { font-size: 1.75rem; }
            .quick-access { grid-template-columns: 1fr; margin-top: -1rem; }
            .mobile-nav { display: flex; }
            .container { padding-bottom: 5rem; }
            .sequences-toolbar { flex-direction: column; align-items: stretch; }
            .search-box { min-width: 100%; }
            .cards-grid { grid-template-columns: 1fr; }
            .guides-tabs { flex-direction: column; }
            .tab-btn { width: 100%; justify-content: center; }
            
            /* Responsive evaluación */
            .auto-grid, .feedback-grid { grid-template-columns: 1fr; }
            .rubrica-table { font-size: 0.8rem; }
            .criterio { width: 25%; }
            .calc-row { flex-direction: column; }
            .eval-tabs { flex-direction: column; }
            .eval-tab-btn { width: 100%; justify-content: center; }
        }

        .text-center { text-align: center; }
        .mt-2 { margin-top: 1rem; }
        input, textarea, select {
            width: 100%; padding: 0.75rem; border: 1px solid var(--border);
            border-radius: 0.375rem; font-family: inherit; margin-bottom: 1rem;
        }
        label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        .empty-state { text-align: center; padding: 3rem; color: var(--text-light); }
        .empty-state i { font-size: 3rem; margin-bottom: 1rem; color: var(--border); }
        
        .sequence-detail-meta {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;
            margin: 1.5rem 0; padding: 1rem; background: var(--bg); border-radius: 0.5rem;
        }
        .meta-item { text-align: center; }
        .meta-item i { color: var(--primary); margin-bottom: 0.25rem; }
        .meta-item .label { font-size: 0.75rem; color: var(--text-light); text-transform: uppercase; }
        .meta-item .value { font-weight: 600; color: var(--text); }
        
        .resources-list { display: flex; flex-direction: column; gap: 0.75rem; margin-top: 1rem; }
        .resource-item {
            display: flex; align-items: center; gap: 1rem; padding: 1rem;
            background: var(--bg); border-radius: 0.5rem; border: 1px solid var(--border);
        }
        .resource-item i { font-size: 1.5rem; color: var(--primary); }
        .resource-info { flex: 1; }
        .resource-info h4 { font-size: 0.95rem; margin-bottom: 0.25rem; }
        .resource-info p { font-size: 0.875rem; color: var(--text-light); }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-atom"></i>
                <span>CyT Huaylas</span>
            </div>
            <nav class="nav-desktop">
                <a href="#secuencias"><i class="fas fa-book-open"></i> Secuencias</a>
                <a href="#guias" class="active"><i class="fas fa-compass"></i> Guías</a>
                <a href="#evaluacion"><i class="fas fa-clipboard-check"></i> Evaluación</a>
                <a href="#tecnologia"><i class="fas fa-laptop"></i> Tecnología</a>
                <a href="#comunidad"><i class="fas fa-users"></i> Comunidad</a>
            </nav>
            <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </header>

    <section class="hero">
        <div class="hero-content">
            <div class="badge">
                <i class="fas fa-check-circle"></i>
                Validado por Especialista CyT - UGEL Huaylas
            </div>
            <h1>Enseña Ciencia con Seguridad y Sentido</h1>
            <p>Recursos prácticos, secuencias validadas y acompañamiento pedagógico real para docentes de Ciencia y Tecnología.</p>
            <div class="hero-actions">
                <a href="#secuencias" class="btn btn-primary">
                    <i class="fas fa-rocket"></i> Ver Secuencias
                </a>
                <a href="#guias" class="btn btn-secondary">
                    <i class="fas fa-compass"></i> Ver Guías
                </a>
            </div>
        </div>
    </section>

    <div class="quick-access">
        <div class="quick-card" onclick="scrollToSection('secuencias')">
            <i class="fas fa-clock"></i>
            <h3>Tengo 10 minutos</h3>
            <p>Ver secuencia rápida lista para usar</p>
        </div>
        <div class="quick-card" onclick="scrollToSection('evaluacion')">
            <i class="fas fa-question-circle"></i>
            <h3>No sé cómo evaluar</h3>
            <p>Rúbricas y ejemplos de evidencias</p>
        </div>
        <div class="quick-card" onclick="scrollToSection('guias')">
            <i class="fas fa-flask"></i>
            <h3>Diseñar indagación</h3>
            <p>Paso a paso con ejemplos reales</p>
        </div>
        <div class="quick-card" onclick="openModal('new-question')">
            <i class="fas fa-headset"></i>
            <h3>Necesito ayuda</h3>
            <p>Consultar al especialista</p>
        </div>
    </div>

    <div class="container">
        <!-- SECUENCIAS -->
        <section id="secuencias" class="section">
            <div class="section-header">
                <h2>Banco de Secuencias Didácticas</h2>
                <p>Sesiones validadas por el especialista, listas para adaptar a tu realidad.</p>
            </div>
            
            <div class="sequences-toolbar">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Buscar secuencias..." onkeyup="filterSequences()">
                </div>
                <div class="filter-group">
                    <button class="filter-btn active" onclick="filterByGrade('all')" id="filter-grade-all">
                        <i class="fas fa-layer-group"></i> Todos
                    </button>
                    <button class="filter-btn" onclick="filterByGrade('1°')" id="filter-grade-1">1° Sec</button>
                    <button class="filter-btn" onclick="filterByGrade('2°')" id="filter-grade-2">2° Sec</button>
                    <button class="filter-btn" onclick="filterByGrade('3°')" id="filter-grade-3">3° Sec</button>
                    <button class="filter-btn" onclick="filterByGrade('4°')" id="filter-grade-4">4° Sec</button>
                    <button class="filter-btn" onclick="filterByGrade('5°')" id="filter-grade-5">5° Sec</button>
                </div>
            </div>
            
            <div class="results-count" id="resultsCount">Cargando secuencias...</div>
            <div class="cards-grid" id="sequencesGrid"></div>
        </section>

        <!-- GUÍAS MEJORADAS -->
        <section id="guias" class="section">
            <div class="section-header">
                <h2>Guías Prácticas</h2>
                <p>Metodologías paso a paso para implementar en tu aula. Selecciona la guía que necesitas.</p>
            </div>
            
            <div class="guides-tabs">
                <button class="tab-btn active" onclick="switchGuide('indagacion')">
                    <div class="tab-icon"><i class="fas fa-microscope"></i></div>
                    <div>
                        <div>Indagación Científica</div>
                        <small style="font-weight: normal; opacity: 0.8;">6 pasos</small>
                    </div>
                </button>
                <button class="tab-btn" onclick="switchGuide('diseno')">
                    <div class="tab-icon"><i class="fas fa-cogs"></i></div>
                    <div>
                        <div>Diseño Tecnológico</div>
                        <small style="font-weight: normal; opacity: 0.8;">5 etapas</small>
                    </div>
                </button>
            </div>
            
            <div id="guide-indagacion" class="guide-content active">
                <div class="guide-intro">
                    <h3 style="margin-bottom: 0.75rem; color: var(--primary);"><i class="fas fa-microscope"></i> Guía de Indagación Científica</h3>
                    <p style="margin-bottom: 1rem;">Metodología para desarrollar investigaciones en el aula, desde la pregunta hasta la conclusión. Ideal para desarrollar la competencia "Indaga mediante métodos científicos".</p>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <span class="feature-tag"><i class="fas fa-clock"></i> Duración: Variable según proyecto</span>
                        <span class="feature-tag"><i class="fas fa-users"></i> Trabajo: Individual o grupal</span>
                        <span class="feature-tag"><i class="fas fa-tools"></i> Materiales: Accesibles y locales</span>
                    </div>
                </div>
                
                <div class="steps-container" id="indagacionSteps"></div>
                
                <div class="template-download">
                    <div class="template-icon"><i class="fas fa-file-alt"></i></div>
                    <div class="template-info">
                        <h4>Plantilla de Indagación Científica</h4>
                        <p>Formato editable con todos los pasos para completar con tus estudiantes</p>
                    </div>
                    <button class="btn btn-green" onclick="downloadTemplate('indagacion')">
                        <i class="fas fa-download"></i> Descargar
                    </button>
                </div>
            </div>
            
            <div id="guide-diseno" class="guide-content">
                <div class="guide-intro diseno">
                    <h3 style="margin-bottom: 0.75rem; color: var(--purple);"><i class="fas fa-cogs"></i> Guía de Diseño Tecnológico</h3>
                    <p style="margin-bottom: 1rem;">Metodología para desarrollar soluciones tecnológicas sostenibles. Ideal para la competencia "Diseña y construye soluciones tecnológicas". Incluye identificación de necesidades, prototipado y evaluación.</p>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <span class="feature-tag"><i class="fas fa-clock"></i> Duración: 4-6 sesiones</span>
                        <span class="feature-tag"><i class="fas fa-users"></i> Trabajo: Grupal preferente</span>
                        <span class="feature-tag"><i class="fas fa-recycle"></i> Enfoque: Sostenibilidad</span>
                    </div>
                </div>
                
                <div class="steps-container" id="disenoSteps"></div>
                
                <div class="template-download">
                    <div class="template-icon" style="color: var(--purple);"><i class="fas fa-drafting-compass"></i></div>
                    <div class="template-info">
                        <h4>Plantilla de Diseño Tecnológico</h4>
                        <p>Formato editable con ficha de diseño, registro de pruebas y matriz de evaluación</p>
                    </div>
                    <button class="btn btn-purple" onclick="downloadTemplate('diseno')">
                        <i class="fas fa-download"></i> Descargar
                    </button>
                </div>
            </div>
        </section>

        <!-- EVALUACIÓN MEJORADA -->
        <section id="evaluacion" class="section">
            <div class="section-header">
                <h2>Evaluación Clara y Usable</h2>
                <p>Herramientas prácticas para evaluar competencias sin complicaciones. Enfoque en el proceso, no solo en el producto final.</p>
            </div>

            <div class="eval-tabs">
                <button class="eval-tab-btn active" onclick="switchEvalTab('rubrica-indagacion', this)">
                    <i class="fas fa-table"></i> Rúbrica Indagación
                </button>
                <button class="eval-tab-btn" onclick="switchEvalTab('rubrica-diseno', this)">
                    <i class="fas fa-cogs"></i> Rúbrica Diseño
                </button>
                <button class="eval-tab-btn" onclick="switchEvalTab('autoevaluacion', this)">
                    <i class="fas fa-user-check"></i> Autoevaluación
                </button>
                <button class="eval-tab-btn" onclick="switchEvalTab('retroalimentacion', this)">
                    <i class="fas fa-comments"></i> Retroalimentación
                </button>
            </div>

            <!-- Rúbrica Indagación -->
            <div id="rubrica-indagacion" class="eval-content active">
                <h3 style="margin-bottom: 1rem; color: var(--primary);"><i class="fas fa-microscope"></i> Rúbrica de Indagación Científica</h3>
                <p style="margin-bottom: 1.5rem; color: var(--text-light);">Evalúa el proceso completo: desde la pregunta hasta la conclusión. Puntuación: 1 (Inicial) a 4 (Satisfactorio)</p>
                
                <div class="rubrica-table-container">
                    <table class="rubrica-table">
                        <thead>
                            <tr>
                                <th>Competencia/Desempeño</th>
                                <th>1 - En Inicio</th>
                                <th>2 - En Proceso</th>
                                <th>3 - Logro Esperado</th>
                                <th>4 - Destacado</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="criterio"><strong>Formula preguntas</strong><br><small>Pregunta de investigación</small></td>
                                <td>Pregunta muy amplia o no investigable ("¿Por qué existe el agua?")</td>
                                <td>Pregunta específica pero no relaciona variables claramente</td>
                                <td>Pregunta clara, concreta, relaciona variables medibles y es investigable con evidencia</td>
                                <td>Pregunta innovadora que conecta variables de forma inesperada o propone nuevas relaciones</td>
                            </tr>
                            <tr>
                                <td class="criterio"><strong>Diseña estrategias</strong><br><small>Hipótesis y procedimiento</small></td>
                                <td>Hipótesis como adivinanza sin justificación. Procedimiento confuso</td>
                                <td>Hipótesis relaciona variables pero sin explicación científica. Procedimiento con pasos faltantes</td>
                                <td>Hipótesis completa (Si...entonces...porque). Procedimiento claro, con controles y repeticiones</td>
                                <td>Hipótesis fundamentada en investigación previa. Procedimiento optimizado con medidas de seguridad</td>
                            </tr>
                            <tr>
                                <td class="criterio"><strong>Genera registros</strong><br><small>Datos y evidencias</small></td>
                                <td>Datos desorganizados, sin unidades, faltan registros</td>
                                <td>Datos en tablas pero con errores de unidades o faltan observaciones cualitativas</td>
                                <td>Tablas organizadas con unidades, datos cuantitativos y cualitativos, fotos o dibujos del proceso</td>
                                <td>Uso de gráficos, identificación de valores atípicos, registro de errores y ajustes durante el proceso</td>
                            </tr>
                            <tr>
                                <td class="criterio"><strong>Analiza e interpreta</strong><br><small>Conclusión</small></td>
                                <td>Conclusión no responde la pregunta o es opinión personal</td>
                                <td>Responde la pregunta pero sin usar datos como evidencia</td>
                                <td>Conclusión estructurada (respuesta, hipótesis, explicación, limitaciones, nuevas preguntas)</td>
                                <td>Análisis crítico que propone aplicaciones prácticas al contexto local o Huaylas</td>
                            </tr>
                            <tr>
                                <td class="criterio"><strong>Reflexiona éticamente</strong><br><small>Impacto e implicancias</small></td>
                                <td>No considera consecuencias del conocimiento generado</td>
                                <td>Menciona impacto superficialmente</td>
                                <td>Analiza impacto ambiental/social local (ej: "¿Cómo afecta esto a nuestra quebrada?")</td>
                                <td>Propone acciones concretas de mejora para la comunidad basadas en resultados</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="calc-box">
                    <h4 style="margin-top: 0; color: var(--secondary);"><i class="fas fa-calculator"></i> Calculadora Rápida</h4>
                    <p style="font-size: 0.9rem; margin-bottom: 1rem;">Selecciona el nivel alcanzado en cada criterio:</p>
                    <div class="calc-row">
                        <label>Pregunta: <select onchange="calcularNotaIndagacion()"><option value="1">1</option><option value="2">2</option><option value="3" selected>3</option><option value="4">4</option></select></label>
                        <label>Diseño: <select onchange="calcularNotaIndagacion()"><option value="1">1</option><option value="2">2</option><option value="3" selected>3</option><option value="4">4</option></select></label>
                        <label>Registros: <select onchange="calcularNotaIndagacion()"><option value="1">1</option><option value="2">2</option><option value="3" selected>3</option><option value="4">4</option></select></label>
                        <label>Análisis: <select onchange="calcularNotaIndagacion()"><option value="1">1</option><option value="2">2</option><option value="3" selected>3</option><option value="4">4</option></select></label>
                        <label>Ética: <select onchange="calcularNotaIndagacion()"><option value="1">1</option><option value="2">2</option><option value="3" selected>3</option><option value="4">4</option></select></label>
                    </div>
                    <div style="text-align: center;">
                        <div class="resultado-final">Promedio: <span id="promedio-indagacion">3.0</span> / 4.0</div>
                    </div>
                </div>
            </div>

            <!-- Rúbrica Diseño -->
           <div id="rubrica-diseno" class="eval-content">
    <h3 style="margin-bottom: 1rem; color: var(--purple);"><i class="fas fa-cogs"></i> Rúbrica de Diseño Tecnológico</h3>
    <p style="margin-bottom: 1.5rem; color: var(--text-light);">Evalúa el proceso completo de diseño: desde la identificación de necesidades hasta la iteración. Puntuación: 1 (Inicial) a 4 (Satisfactorio)</p>
    
    <div class="rubrica-table-container">
        <table class="rubrica-table">
            <thead>
                <tr>
                    <th>Competencia/Desempeño</th>
                    <th>1 - En Proceso</th>
                    <th>2 - Logro Intermedio</th>
                    <th>3 - Logro Esperado</th>
                    <th>4 - Destacado</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="criterio" style="background: #faf5ff !important; color: #6b21a8;"><strong>Identifica necesidades</strong><br><small>Reconocimiento de problemas</small></td>
                    <td>Propone soluciones sin identificar una necesidad real previa. El problema es inventado o no existe en el contexto.</td>
                    <td>Identifica una necesidad pero es muy general o poco relevante para el contexto escolar/comunal.</td>
                    <td>Detecta necesidad real del entorno (escuela, hogar, comunidad) que afecta a personas específicas y es factible de resolver.</td>
                    <td>Valida la necesidad con usuarios reales (entrevistas, observación). Analiza profundamente el contexto de Huaylas y propone alternativas innovadoras.</td>
                </tr>
                <tr>
                    <td class="criterio" style="background: #faf5ff !important; color: #6b21a8;"><strong>Investiga el estado del arte</strong><br><small>Búsqueda de soluciones</small></td>
                    <td>No investiga. Propone diseños sin buscar referencias o copia exactamente sin adaptar.</td>
                    <td>Busca en una sola fuente (solo internet o solo opinión personal). No compara alternativas.</td>
                    <td>Consulta diversas fuentes (saberes locales, internet, libros). Adapta soluciones existentes al contexto y recursos disponibles.</td>
                    <td>Investiga saberes ancestrales locales + soluciones modernas. Propone mejoras innovadoras a lo existente y documenta fuentes.</td>
                </tr>
                <tr>
                    <td class="criterio" style="background: #faf5ff !important; color: #6b21a8;"><strong>Diseña la propuesta</strong><br><small>Planificación y bocetos</small></td>
                    <td>Sin bocetos o dibujos confusos. Materiales irreales o peligrosos. No define cómo funcionará.</td>
                    <td>Boceto simple sin detalles. Materiales costosos o difíciles de conseguir en Huaylas. Funcionamiento poco claro.</td>
                    <td>Dibujos claros (vistas frontales/laterales), lista detallada de materiales locales/reciclados, explicación del funcionamiento y criterios de éxito definidos.</td>
                    <td>Bocetos técnicos detallados con medidas. Planificación de ensamblaje paso a paso. Análisis de sostenibilidad y seguridad integrados.</td>
                </tr>
                <tr>
                    <td class="criterio" style="background: #faf5ff !important; color: #6b21a8;"><strong>Construye y prueba</strong><br><small>Prototipado y validación</small></td>
                    <td>No termina la construcción o prototipo inseguro/inestable. No realiza pruebas.</td>
                    <td>Prototipo frágil o con riesgos de seguridad. Una sola prueba sin registro sistemático de datos.</td>
                    <td>Construcción segura y funcional. Prueba al menos 2 veces bajo condiciones reales. Registra datos en tablas con fotografías del proceso.</td>
                    <td>Prototipo robusto usando técnicas adecuadas. Pruebas rigurosas (3+ veces), identificación de fallas, ajustes documentados y registro fotográfico completo.</td>
                </tr>
                <tr>
                    <td class="criterio" style="background: #faf5ff !important; color: #6b21a8;"><strong>Evalúa e itera</strong><br><small>Mejora continua</small></td>
                    <td>No reconoce errores o culpa a factores externos. No propone mejoras.</td>
                    <td>Reconoce que hay problemas pero no propone soluciones claras o factibles.</td>
                    <td>Compara resultados con criterios de éxito definidos. Identifica fallas específicas y propone mejoras concretas aplicables (versión 2.0).</td>
                    <td>Implementa mejoras y las vuelve a probar. Análisis costo-beneficio, sostenibilidad a largo plazo y propuesta de escalabilidad para la comunidad.</td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <div class="calc-box" style="background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%); border-color: #d8b4fe;">
        <h4 style="margin-top: 0; color: var(--purple);"><i class="fas fa-calculator"></i> Calculadora Rápida</h4>
        <p style="font-size: 0.9rem; margin-bottom: 1rem;">Selecciona el nivel alcanzado en cada criterio:</p>
        <div class="calc-row">
            <label>Necesidad: <select onchange="calcularNotaDiseno()"><option value="1">1</option><option value="2">2</option><option value="3" selected>3</option><option value="4">4</option></select></label>
            <label>Investigación: <select onchange="calcularNotaDiseno()"><option value="1">1</option><option value="2">2</option><option value="3" selected>3</option><option value="4">4</option></select></label>
            <label>Diseño: <select onchange="calcularNotaDiseno()"><option value="1">1</option><option value="2">2</option><option value="3" selected>3</option><option value="4">4</option></select></label>
            <label>Construcción: <select onchange="calcularNotaDiseno()"><option value="1">1</option><option value="2">2</option><option value="3" selected>3</option><option value="4">4</option></select></label>
            <label>Iteración: <select onchange="calcularNotaDiseno()"><option value="1">1</option><option value="2">2</option><option value="3" selected>3</option><option value="4">4</option></select></label>
        </div>
        <div style="text-align: center;">
            <div class="resultado-final" style="color: var(--purple);">Promedio: <span id="promedio-diseno">3.0</span> / 4.0</div>
        </div>
    </div>
</div>
function calcularNotaDiseno() {
    const selects = document.querySelectorAll('#rubrica-diseno select');
    let suma = 0;
    selects.forEach(select => {
        suma += parseInt(select.value);
    });
    const promedio = (suma / selects.length).toFixed(1);
    document.getElementById('promedio-diseno').textContent = promedio;
}
            <!-- Autoevaluación -->
            <div id="autoevaluacion" class="eval-content">
                <h3 style="margin-bottom: 1rem; color: var(--secondary);"><i class="fas fa-user-check"></i> Autoevaluación para Estudiantes</h3>
                <p style="margin-bottom: 1.5rem; color: var(--text-light);">Instrumentos simples para que el estudiante reflexione sobre su proceso</p>
                
                <div class="auto-grid">
                    <div class="auto-box">
                        <h4><i class="fas fa-microscope"></i> Durante la Indagación</h4>
                        <div class="checklist-eval">
                            <label class="check-item">
                                <input type="checkbox"> Mi pregunta puede responderse con evidencia, no solo opinión
                            </label>
                            <label class="check-item">
                                <input type="checkbox"> Controlé variables (mantuve todo igual excepto lo que cambié)
                            </label>
                            <label class="check-item">
                                <input type="checkbox"> Repetí el experimento al menos 3 veces
                            </label>
                            <label class="check-item">
                                <input type="checkbox"> Anoté todo: números Y observaciones (olores, colores, sonidos)
                            </label>
                            <label class="check-item">
                                <input type="checkbox"> Mi conclusión usa los datos que recogí, no lo que "creo"
                            </label>
                            <label class="check-item">
                                <input type="checkbox"> Pensé en cómo mi investigación ayuda a mi comunidad
                            </label>
                        </div>
                    </div>

                    <div class="auto-box">
                        <h4><i class="fas fa-cogs"></i> Durante el Diseño</h4>
                        <div class="checklist-eval">
                            <label class="check-item">
                                <input type="checkbox"> Hablamos con personas que tienen el problema para entenderlo bien
                            </label>
                            <label class="check-item">
                                <input type="checkbox"> Usamos materiales que encontramos fácilmente en Huaylas (no caros)
                            </label>
                            <label class="check-item">
                                <input type="checkbox"> Hicimos dibujos del prototipo antes de construir
                            </label>
                            <label class="check-item">
                                <input type="checkbox"> Trabajamos con seguridad (tijeras, cuchillos, pegamento con cuidado)
                            </label>
                            <label class="check-item">
                                <input type="checkbox"> Probamos el prototipo varias veces y anotamos qué pasó
                            </label>
                            <label class="check-item">
                                <input type="checkbox"> Propusimos al menos 2 mejoras concretas para la próxima versión
                            </label>
                        </div>
                    </div>

                    <div class="reflexion-box">
                        <h4><i class="fas fa-pen"></i> Reflexión Final (Escribe 3 líneas)</h4>
                        <div class="input-group">
                            <label>Lo más difícil fue:</label>
                            <textarea placeholder="Ej: Controlar la temperatura del agua porque cambiaba rápido..."></textarea>
                        </div>
                        <div class="input-group">
                            <label>Lo que aprendí y puedo usar en mi vida:</label>
                            <textarea placeholder="Ej: Ahora sé que debo probar varias veces antes de concluir..."></textarea>
                        </div>
                        <div class="input-group">
                            <label>Si lo hiciera de nuevo, cambiaría:</label>
                            <textarea placeholder="Ej: Usaría botellas más grandes para que dure más el riego..."></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Retroalimentación -->
            <div id="retroalimentacion" class="eval-content">
                <h3 style="margin-bottom: 1rem; color: var(--accent);"><i class="fas fa-comments"></i> Guía de Retroalimentación Efectiva</h3>
                <p style="margin-bottom: 1.5rem; color: var(--text-light);">Cómo dar comentarios que mejoren el aprendizaje sin desmotivar</p>
                
                <div class="feedback-grid">
                    <div class="feedback-card">
                        <h4><i class="fas fa-check-circle"></i> Ejemplos de Retroalimentación Constructiva</h4>
                        
                        <div class="ejemplo">
                            <span class="tag">En lugar de:</span>
                            <p class="mal">"Está mal tu hipótesis"</p>
                            <span class="tag">Mejor:</span>
                            <p class="bien">"Tu hipótesis conecta temperatura y disolución, pero ¿podrías explicar por qué crees que ocurre eso? Recuerda el 'porque' científico"</p>
                        </div>
                        
                        <div class="ejemplo">
                            <span class="tag">En lugar de:</span>
                            <p class="mal">"El prototipo no sirve"</p>
                            <span class="tag">Mejor:</span>
                            <p class="bien">"El sistema gotea muy rápido (2 días vs 3 esperados). ¿Qué pasa si haces el agujero más pequeño o usas tapa de rocío?"</p>
                        </div>
                        
                        <div class="ejemplo">
                            <span class="tag">En lugar de:</span>
                            <p class="mal">"Faltan datos"</p>
                            <span class="tag">Mejor:</span>
                            <p class="bien">"Veo que mediste el tiempo pero no anotaste si el día estaba soleado o nublado. Eso podría explicar por qué un ensayo fue diferente"</p>
                        </div>
                    </div>

                    <div class="feedback-card tecnica-card">
                        <h4><i class="fas fa-bread-slice"></i> Técnica del "Sándwich de Retroalimentación"</h4>
                        <ol>
                            <li><strong>Pan superior (Fortaleza específica):</strong> "Me gusta cómo usaste materiales reciclados de la comunidad"</li>
                            <li><strong>Relleno (Área de mejora concreta):</strong> "Para la próxima, necesitas hacer 3 repeticiones, no solo una, para que tus datos sean confiables"</li>
                            <li><strong>Pan inferior (Confianza):</strong> "Veo que entiendes bien el método, vas por buen camino"</li>
                        </ol>
                    </div>

                    <div class="feedback-card phrases-card">
                        <h4><i class="fas fa-comment-dots"></i> Frases Útiles para el Docente</h4>
                        <ul>
                            <li><em>"Los datos dicen..."</em> (objetiva, no opinativa)</li>
                            <li><em>"Según tu tabla..."</em> (evidencia concreta)</li>
                            <li><em>"Un científico/diseñador notaría que..."</em> (rol profesional)</li>
                            <li><em>"¿Qué pasaría si...?"</em> (provocar pensamiento)</li>
                            <li><em>"Esto me recuerda a..."</em> (conectar con saberes locales)</li>
                            <li><em>"Tu quebrada/comunidad necesitaría..."</em> (contextualizar)</li>
                        </ul>
                    </div>

                    <div class="feedback-card registro-card">
                        <h4><i class="fas fa-clipboard"></i> Registro Rápido de Observaciones</h4>
                        <div class="quick-form">
                            <div class="form-row">
                                <span>Fecha: ___/___</span>
                                <span>Grupo/Est: ____________</span>
                            </div>
                            <div style="margin-bottom: 0.5rem;">
                                <strong style="font-size: 0.875rem; color: var(--text-light);">Observación específica:</strong>
                                <div class="obs-line"></div>
                                <strong style="font-size: 0.875rem; color: var(--text-light);">Pregunta provocadora:</strong>
                                <div class="obs-line"></div>
                            </div>
                            <div class="check-tipo">
                                <label><input type="checkbox"> Indagación</label>
                                <label><input type="checkbox"> Diseño</label>
                                <label><input type="checkbox"> Trabajo colab.</label>
                                <label><input type="checkbox"> Seguridad</label>
                            </div>
                        </div>
                        <p style="font-size: 0.875rem; color: var(--text-light); margin-top: 0.75rem; font-style: italic;">
                            <strong>Tip:</strong> Anota inmediatamente, no al final de clase. Una observación específica vale más que una nota genérica.
                        </p>
                    </div>
                </div>
            </div>

            <div class="download-eval-box">
                <h4 style="margin-bottom: 1rem;"><i class="fas fa-download"></i> Descargables</h4>
                <button class="btn-download" onclick="alert('Descargando: rúbrica_indagacion.pdf')">
                    <i class="fas fa-file-pdf"></i> Rúbrica Indagación (PDF)
                </button>
                <button class="btn-download" onclick="alert('Descargando: rúbrica_diseno.pdf')">
                    <i class="fas fa-file-pdf"></i> Rúbrica Diseño (PDF)
                </button>
                <button class="btn-download" onclick="alert('Descargando: registro_observaciones.docx')">
                    <i class="fas fa-file-word"></i> Registro Observaciones (Word)
                </button>
            </div>
        </section>

        <section id="tecnologia" class="section">
            <div class="section-header">
                <h2>Tecnología con Sentido Pedagógico</h2>
                <p>Recursos curados: cada herramienta indica para qué competencia sirve.</p>
            </div>
            <div class="cards-grid" id="techGrid"></div>
        </section>

        <section id="comunidad" class="section">
            <div class="section-header">
                <h2>Comunidad Docente Guiada</h2>
                <p>Espacio moderado por el Especialista de CyT. Consultas reales de docentes.</p>
            </div>
            <div class="community-preview">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3 style="color: var(--secondary);"><i class="fas fa-comments"></i> Consultas Recientes</h3>
                    <button class="btn btn-primary btn-small" onclick="openModal('new-question')">
                        <i class="fas fa-plus"></i> Nueva consulta
                    </button>
                </div>
                <div id="loadingQuestions" style="text-align: center; padding: 2rem;">
                    <div class="loading"></div>
                    <p style="margin-top: 1rem; color: var(--text-light);">Cargando consultas...</p>
                </div>
                <div class="discussion-list" id="questionsList" style="display: none;"></div>
            </div>
        </section>

        <footer style="text-align: center; padding: 3rem 0; color: var(--text-light); border-top: 1px solid var(--border); margin-top: 4rem;">
            <p style="margin-bottom: 0.5rem;"><strong>UGEL Huaylas - Área de Ciencia y Tecnología</strong></p>
            <p style="font-size: 0.875rem;">Plataforma validada por el Especialista de CyT</p>
            <p style="font-size: 0.875rem; margin-top: 1rem;">
                <a href="admin.html" style="color: var(--text-light);"><i class="fas fa-lock"></i> Acceso Especialista</a>
            </p>
        </footer>
    </div>

    <nav class="mobile-nav">
        <a href="#secuencias"><i class="fas fa-book-open"></i><span>Secuencias</span></a>
        <a href="#guias" class="active"><i class="fas fa-compass"></i><span>Guías</span></a>
        <a href="#evaluacion"><i class="fas fa-clipboard-check"></i><span>Evaluar</span></a>
        <a href="#comunidad"><i class="fas fa-users"></i><span>Ayuda</span></a>
    </nav>

    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Título</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <script>
        // ==================== CONFIGURACIÓN FIREBASE ====================
        const firebaseConfig = {
            apiKey: "AIzaSyCrhIGOJxb4DbF9ElLt1x6IV1KwO3epGCo",
            authDomain: "cyt-huaylas-web.firebaseapp.com",
            projectId: "cyt-huaylas-web",
            storageBucket: "cyt-huaylas-web.firebasestorage.app",
            messagingSenderId: "663512465593",
            appId: "1:663512465593:web:cd4a6601f51b6d48505b68"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // ==================== DATOS DE SECUENCIAS ====================
        const sequences = [
            {
                id: 1, title: "¿Por qué se erosiona nuestra quebrada?", grade: "1° Secundaria",
                area: "Indagación científica", duration: "4 sesiones", context: "Rural/Urbano",
                description: "Secuencia completa de indagación sobre erosión del suelo usando el entorno local.",
                tags: ["indagacion"], validated: true, competencias: ["Indaga", "Explica"]
            },
            {
                id: 2, title: "Diseño de un irrigador para la huerta escolar", grade: "2° Secundaria",
                area: "Diseño tecnológico", duration: "6 sesiones", context: "Rural",
                description: "Los estudiantes identifican necesidades de riego, proponen diseños con materiales locales.",
                tags: ["diseno"], validated: true, competencias: ["Diseña", "Evalúa"]
            },
            {
                id: 3, title: "¿El agua de mi comunidad es potable?", grade: "3° Secundaria",
                area: "Indagación científica", duration: "5 sesiones", context: "Rural/Urbano",
                description: "Análisis físico-químico básico del agua usando reactivos caseros.",
                tags: ["indagacion"], validated: true, competencias: ["Indaga", "Comunica"]
            }
        ];

        // ==================== PASOS DE INDAGACIÓN ====================
        const indagacionSteps = [
            {
                num: 1, title: "Planteamiento del Problema", subtitle: "La pregunta investigable",
                content: `
                    <div class="step-section">
                        <h4><i class="fas fa-question-circle"></i> ¿Qué hacer?</h4>
                        <p>Formular una pregunta clara, concreta y que se pueda responder mediante evidencia. Debe conectar con el contexto del estudiante.</p>
                    </div>
                    <div class="step-section">
                        <h4><i class="fas fa-lightbulb"></i> Características de una buena pregunta</h4>
                        <ul class="checklist">
                            <li><i class="fas fa-check"></i> <div>Sea específica (no muy amplia)</div></li>
                            <li><i class="fas fa-check"></i> <div>Relacione variables medibles</div></li>
                            <li><i class="fas fa-check"></i> <div>Sea relevante para el contexto local</div></li>
                            <li><i class="fas fa-check"></i> <div>Pueda responderse con evidencia (no opinión)</div></li>
                        </ul>
                    </div>
                    <div class="example-box good">
                        <strong><i class="fas fa-check-circle"></i> EJEMPLO VÁLIDO</strong>
                        "¿Cómo afecta la salinidad del agua del río a la flotación de objetos?"
                    </div>
                    <div class="example-box bad">
                        <strong><i class="fas fa-times-circle"></i> ERROR COMÚN</strong>
                        "Investigar sobre el agua" (muy amplia) o "¿El agua es importante?" (no investigable)
                    </div>
                    <div class="tools-box">
                        <h4><i class="fas fa-tools"></i> Herramientas útiles</h4>
                        <ul>
                            <li>Mapa de contexto: ¿Qué problemas observan los estudiantes?</li>
                            <li>Lluvia de ideas: Todas las preguntas son válidas inicialmente</li>
                            <li>Filtro de preguntas: ¿Es investigable? ¿Tenemos acceso?</li>
                        </ul>
                    </div>
                `
            },
            {
                num: 2, title: "Identificación de Variables", subtitle: "Lo que cambia y lo que mide",
                content: `
                    <div class="step-section">
                        <h4><i class="fas fa-exchange-alt"></i> Tipos de variables</h4>
                        <div style="display: grid; gap: 1rem; margin-bottom: 1rem;">
                            <div style="padding: 1rem; background: #dbeafe; border-radius: 0.5rem; border-left: 4px solid #2563eb;">
                                <strong style="color: #1e40af;">Variable Independiente</strong>
                                <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem;">Lo que el estudiante decide cambiar (la causa)</p>
                            </div>
                            <div style="padding: 1rem; background: #dcfce7; border-radius: 0.5rem; border-left: 4px solid #16a34a;">
                                <strong style="color: #166534;">Variable Dependiente</strong>
                                <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem;">Lo que se mide u observa (el efecto)</p>
                            </div>
                            <div style="padding: 1rem; background: #f3f4f6; border-radius: 0.5rem; border-left: 4px solid #6b7280;">
                                <strong style="color: #374151;">Variables Controladas</strong>
                                <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem;">Lo que se mantiene constante para que sea justo</p>
                            </div>
                        </div>
                    </div>
                    <div class="example-box good">
                        <strong><i class="fas fa-flask"></i> EJEMPLO PRÁCTICO</strong>
                        <strong>Experimento:</strong> "¿Cómo afecta la temperatura a la velocidad de disolución del azúcar?"<br><br>
                        <strong>Independiente:</strong> Temperatura del agua (fría, tibia, caliente)<br>
                        <strong>Dependiente:</strong> Tiempo que tarda en disolverse (en segundos)<br>
                        <strong>Controladas:</strong> Cantidad de agua (200ml), tipo de azúcar (blanca), cantidad de azúcar (5g), no agitar
                    </div>
                    <div class="tools-box">
                        <h4><i class="fas fa-exclamation-triangle"></i> Errores comunes a evitar</h4>
                        <ul>
                            <li>Confundir la variable dependiente con el resultado deseado</li>
                            <li>Olvidar controlar variables que sí afectan el resultado</li>
                            <li>Elegir variables que no se pueden medir en el aula</li>
                        </ul>
                    </div>
                `
            },
            {
                num: 3, title: "Hipótesis Argumentada", subtitle: "Predicción con fundamento",
                content: `
                    <div class="step-section">
                        <h4><i class="fas fa-brain"></i> ¿Qué es una hipótesis?</h4>
                        <p>Respuesta tentativa a la pregunta de investigación, basada en conocimiento previo. Debe establecer una relación clara entre variables.</p>
                    </div>
                    <div class="step-section">
                        <h4><i class="fas fa-pencil-alt"></i> Estructura recomendada</h4>
                        <div style="padding: 1rem; background: #eff6ff; border-radius: 0.5rem; font-family: monospace; margin-bottom: 1rem;">
                            "Si [cambio en variable independiente], entonces [efecto en variable dependiente] porque [justificación científica]"
                        </div>
                    </div>
                    <div class="example-box good">
                        <strong><i class="fas fa-check-circle"></i> HIPÓTESIS FUERTE</strong>
                        "Si aumenta la temperatura del agua, entonces el azúcar se disolverá más rápido porque las partículas se mueven con mayor energía cinética y chocan más frecuentemente."
                    </div>
                    <div class="example-box bad">
                        <strong><i class="fas fa-times-circle"></i> HIPÓTESIS DÉBIL</strong>
                        "Creo que el azúcar se disuelve en agua caliente." (No relaciona variables, no tiene justificación)
                    </div>
                    <div class="tools-box">
                        <h4><i class="fas fa-graduation-cap"></i> Para nivel secundaria</h4>
                        <ul>
                            <li>Acepta hipótesis que no se cumplan (aprendizaje válido)</li>
                            <li>La justificación puede basarse en observaciones previas, no solo teoría</li>
                            <li>Fomenta que usen "si... entonces..." para estructurar el pensamiento</li>
                        </ul>
                    </div>
                `
            },
            {
                num: 4, title: "Diseño Experimental", subtitle: "El plan para probar",
                content: `
                    <div class="step-section">
                        <h4><i class="fas fa-clipboard-list"></i> Elementos del diseño</h4>
                        <ul class="checklist">
                            <li><i class="fas fa-check"></i> <div><strong>Materiales:</strong> Lista detallada y accesibles</div></li>
                            <li><i class="fas fa-check"></i> <div><strong>Procedimiento:</strong> Pasos numerados y claros</div></li>
                            <li><i class="fas fa-check"></i> <div><strong>Repeticiones:</strong> Mínimo 3 veces para confiabilidad</div></li>
                            <li><i class="fas fa-check"></i> <div><strong>Seguridad:</strong> Identificar riesgos y precauciones</div></li>
                        </ul>
                    </div>
                    <div class="example-box good">
                        <strong><i class="fas fa-list-ol"></i> EJEMPLO DE PROCEDIMIENTO</strong>
                        <ol style="margin: 0.5rem 0 0 1.25rem;">
                            <li>Medir 200ml de agua y calentar a 30°C (agua fría)</li>
                            <li>Agregar 5g de azúcar y cronometrar tiempo de disolución completa</li>
                            <li>Repetir con agua a 50°C (tibia) y 70°C (caliente)</li>
                            <li>Registrar datos en tabla</li>
                            <li>Repetir todo el proceso 3 veces (3 repeticiones)</li>
                        </ol>
                    </div>
                    <div class="tools-box">
                        <h4><i class="fas fa-lightbulb"></i> Consejos prácticos</h4>
                        <ul>
                            <li>Usa materiales del entorno (agua de río, tierra local, plantas nativas)</li>
                            <li>Si no hay termómetro, usa percepción táctil pero registra consistentemente</li>
                            <li>Anticipa "¿qué puede salir mal?" y ten plan B</li>
                            <li>Involucra a los estudiantes en el diseño, no solo en la ejecución</li>
                        </ul>
                    </div>
                `
            },
            {
                num: 5, title: "Recolección de Evidencias", subtitle: "Datos confiables",
                content: `
                    <div class="step-section">
                        <h4><i class="fas fa-table"></i> Tipos de evidencia</h4>
                        <div style="display: grid; gap: 1rem; margin-bottom: 1rem; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
                            <div style="padding: 1rem; background: #f0fdf4; border-radius: 0.5rem;">
                                <strong style="color: var(--secondary);"><i class="fas fa-ruler"></i> Cuantitativos</strong>
                                <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem;">Números, mediciones, conteos. Ej: tiempo, temperatura, distancia</p>
                            </div>
                            <div style="padding: 1rem; background: #fef3c7; border-radius: 0.5rem;">
                                <strong style="color: #92400e;"><i class="fas fa-eye"></i> Cualitativos</strong>
                                <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem;">Descripciones, colores, texturas, observaciones</p>
                            </div>
                        </div>
                    </div>
                    <div class="step-section">
                        <h4><i class="fas fa-exclamation-circle"></i> Registro efectivo</h4>
                        <ul class="checklist">
                            <li><i class="fas fa-check"></i> <div>Incluye unidades en todas las mediciones</div></li>
                            <li><i class="fas fa-check"></i> <div>Anota observaciones inesperadas (errores, sorpresas)</div></li>
                            <li><i class="fas fa-check"></i> <div>Usa tablas organizadas desde antes del experimento</div></li>
                            <li><i class="fas fa-check"></i> <div>Fotografía o dibuja el proceso</div></li>
                        </ul>
                    </div>
                    <div class="example-box good">
                        <strong><i class="fas fa-table"></i> TABLA DE REGISTRO EJEMPLO</strong>
                        <table style="width: 100%; margin-top: 0.5rem; border-collapse: collapse; font-size: 0.875rem;">
                            <tr style="background: #e5e7eb;">
                                <th style="padding: 0.5rem; border: 1px solid #d1d5db;">Ensayo</th>
                                <th style="padding: 0.5rem; border: 1px solid #d1d5db;">Temperatura</th>
                                <th style="padding: 0.5rem; border: 1px solid #d1d5db;">Tiempo (s)</th>
                                <th style="padding: 0.5rem; border: 1px solid #d1d5db;">Observaciones</th>
                            </tr>
                            <tr>
                                <td style="padding: 0.5rem; border: 1px solid #d1d5db;">1</td>
                                <td style="padding: 0.5rem; border: 1px solid #d1d5db;">Fría</td>
                                <td style="padding: 0.5rem; border: 1px solid #d1d5db;"></td>
                                <td style="padding: 0.5rem; border: 1px solid #d1d5db;"></td>
                            </tr>
                        </table>
                    </div>
                `
            },
            {
                num: 6, title: "Análisis y Conclusión", subtitle: "Sacar sentido a los datos",
                content: `
                    <div class="step-section">
                        <h4><i class="fas fa-chart-line"></i> Análisis de datos</h4>
                        <p>Organizar, representar (tablas, gráficos) e interpretar los datos para encontrar patrones.</p>
                        <ul class="checklist">
                            <li><i class="fas fa-check"></i> <div>Calcula promedios si hay repeticiones</div></li>
                            <li><i class="fas fa-check"></i> <div>Identifica valores atípicos y explica por qué</div></li>
                            <li><i class="fas fa-check"></i> <div>Busca relaciones entre variables</div></li>
                        </ul>
                    </div>
                    <div class="step-section">
                        <h4><i class="fas fa-flag-checkered"></i> Estructura de la conclusión</h4>
                        <div style="padding: 1rem; background: #f0fdf4; border-radius: 0.5rem;">
                            <ol style="margin-left: 1.25rem; margin-bottom: 0;">
                                <li style="margin-bottom: 0.5rem;"><strong>¿Qué descubrimos?</strong> - Responde la pregunta con datos</li>
                                <li style="margin-bottom: 0.5rem;"><strong>¿Se cumplió la hipótesis?</strong> - Confirma o rechaza con evidencia</li>
                                <li style="margin-bottom: 0.5rem;"><strong>¿Por qué?</strong> - Explicación científica breve</li>
                                <li style="margin-bottom: 0.5rem;"><strong>Limitaciones:</strong> - ¿Qué pudo afectar los resultados?</li>
                                <li><strong>Nuevas preguntas:</strong> - ¿Qué queda por investigar?</li>
                            </ol>
                        </div>
                    </div>
                    <div class="example-box good">
                        <strong><i class="fas fa-check-circle"></i> CONCLUSIÓN COMPLETA</strong>
                        "Los datos muestran que el azúcar se disuelve más rápido en agua caliente (promedio 15s) que en fría (promedio 45s). Esto confirma nuestra hipótesis porque la mayor energía térmica aumenta el movimiento de partículas. Una limitación fue que no controlamos la humedad ambiental. Para mejorar, podríamos hacer más repeticiones y probar con otros tipos de azúcar."
                    </div>
                `
            }
        ];

        // ==================== PASOS DE DISEÑO TECNOLÓGICO ====================
        const disenoSteps = [
            {
                num: 1, title: "Identificación de la Necesidad", subtitle: "¿Qué problema resolver?",
                content: `
                    <div class="step-section">
                        <h4><i class="fas fa-search"></i> Diagnóstico del contexto</h4>
                        <p>Observar el entorno cercano (escuela, hogar, comunidad) para detectar necesidades reales que puedan resolverse con una solución tecnológica.</p>
                    </div>
                    <div class="step-section">
                        <h4><i class="fas fa-clipboard-check"></i> Criterios para identificar necesidades válidas</h4>
                        <ul class="checklist">
                            <li><i class="fas fa-check"></i> <div>Afecta a personas reales del contexto</div></li>
                            <li><i class="fas fa-check"></i> <div>Puede resolverse con recursos locales</div></li>
                            <li><i class="fas fa-check"></i> <div>Es factible en el tiempo disponible</div></li>
                            <li><i class="fas fa-check"></i> <div>Genera impacto positivo sostenible</div></li>
                        </ul>
                    </div>
                    <div class="example-box good">
                        <strong><i class="fas fa-check-circle"></i> EJEMPLOS DE NECESIDADES VÁLIDAS</strong>
                        <ul style="margin: 0.5rem 0 0 1.25rem;">
                            <li>El riego de la huerta escolar es irregular y depende de quién esté presente</li>
                            <li>No hay sistema de separación de residuos orgánicos en la escuela</li>
                            <li>Falta almacenamiento seguro para herramientas de la huerta</li>
                            <li>El agua de lluvia se desperdicia y podría aprovecharse</li>
                        </ul>
                    </div>
                    <div class="example-box bad">
                        <strong><i class="fas fa-times-circle"></i> NECESIDADES POCO VIABLES</strong>
                        "Diseñar un robot que limpie la escuela" (muy complejo, recursos inaccesibles) o "Hacer un avión" (no resuelve necesidad real identificada)
                    </div>
                    <div class="tools-box">
                        <h4><i class="fas fa-tools"></i> Técnicas de diagnóstico</h4>
                        <ul>
                            <li><strong>Recorrido guiado:</strong> Caminar por la escuela con los estudiantes anotando problemas</li>
                            <li><strong>Entrevistas:</strong> Preguntar a directivos, jardineros, cocineros sobre sus necesidades</li>
                            <li><strong>Mapeo:</strong> Dibujar la escuela y marcar zonas problemáticas</li>
                        </ul>
                    </div>
                `
            },
            {
                num: 2, title: "Investigación de Soluciones", subtitle: "¿Qué ya existe?",
                content: `
                    <div class="step-section">
                        <h4><i class="fas fa-book-open"></i> Estado del arte</h4>
                        <p>Buscar cómo otras personas han resuelto problemas similares. No reinventar, sino adaptar y mejorar.</p>
                    </div>
                    <div class="step-section">
                        <h4><i class="fas fa-list-ul"></i> Fuentes de investigación</h4>
                        <div style="display: grid; gap: 0.75rem; margin-bottom: 1rem;">
                            <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: var(--bg); border-radius: 0.5rem;">
                                <i class="fas fa-users" style="color: var(--purple);"></i>
                                <div><strong>Saberes locales:</strong> Preguntar a adultos de la comunidad cómo solucionaban antes</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: var(--bg); border-radius: 0.5rem;">
                                <i class="fas fa-video" style="color: var(--purple);"></i>
                                <div><strong>Videos tutoriales:</strong> Buscar soluciones similares en internet (cuando haya conexión)</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: var(--bg); border-radius: 0.5rem;">
                                <i class="fas fa-book" style="color: var(--purple);"></i>
                                <div><strong>Textos escolares:</strong> Revisar libros de CyT de grados anteriores</div>
                            </div>
                        </div>
                    </div>
                    <div class="example-box good">
                        <strong><i class="fas fa-lightbulb"></i> EJEMPLO DE INVESTIGACIÓN</strong>
                        <strong>Problema:</strong> Riego irregular de la huerta<br><br>
                        <strong>Soluciones encontradas:</strong><br>
                        • Sistema de riego por goteo con botellas (bajo costo)<br>
                        • Sistema de capilaridad con mechas de tela<br>
                        • Programadores de riego comerciales (caros)<br>
                        • Riego manual con horario fijo (depende de personas)<br><br>
                        <strong>Análisis:</strong> El sistema de goteo con botellas es el más adecuado porque usa materiales reciclados disponibles y no requiere electricidad.
                    </div>
                    <div class="tools-box">
                        <h4><i class="fas fa-table"></i> Registro de investigación</h4>
                        <p>Crear tabla comparativa:</p>
                        <table style="width: 100%; margin-top: 0.5rem; font-size: 0.875rem; border-collapse: collapse;">
                            <tr style="background: #f3e8ff;">
                                <th style="padding: 0.5rem; border: 1px solid #d8b4fe;">Solución</th>
                                <th style="padding: 0.5rem; border: 1px solid #d8b4fe;">Ventajas</th>
                                <th style="padding: 0.5rem; border: 1px solid #d8b4fe;">Desventajas</th>
                            </tr>
                            <tr>
                                <td style="padding: 0.5rem; border: 1px solid #e9d5ff;">Opción A</td>
                                <td style="padding: 0.5rem; border: 1px solid #e9d5ff;"></td>
                                <td style="padding: 0.5rem; border: 1px solid #e9d5ff;"></td>
                            </tr>
                        </table>
                    </div>
                `
            },
            {
                num: 3, title: "Propuesta de Diseño", subtitle: "Del boceto al plan",
                content: `
                    <div class="step-section">
                        <h4><i class="fas fa-pencil-ruler"></i> Elementos del diseño</h4>
                        <ul class="checklist">
                            <li><i class="fas fa-check"></i> <div><strong>Bocetos:</strong> Dibujos de diferentes vistas (frente, lado, arriba)</div></li>
                            <li><i class="fas fa-check"></i> <div><strong>Lista de materiales:</strong> Detallada con cantidades</div></li>
                            <li><i class="fas fa-check"></i> <div><strong>Funcionamiento:</strong> Explicación de cómo opera</div></li>
                            <li><i class="fas fa-check"></i> <div><strong>Criterios de éxito:</strong> ¿Cómo sabremos si funciona?</div></li>
                        </ul>
                    </div>
                    <div class="step-section">
                        <h4><i class="fas fa-recycle"></i> Criterios de sostenibilidad</h4>
                        <div style="display: grid; gap: 0.5rem; margin-bottom: 1rem;">
                            <div style="padding: 0.75rem; background: #f0fdf4; border-radius: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fas fa-leaf" style="color: var(--secondary);"></i>
                                <span>Usa materiales reciclados o locales</span>
                            </div>
                            <div style="padding: 0.75rem; background: #f0fdf4; border-radius: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fas fa-bolt" style="color: var(--secondary);"></i>
                                <span>No requiere energía eléctrica (preferente)</span>
                            </div>
                            <div style="padding: 0.75rem; background: #f0fdf4; border-radius: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fas fa-wrench" style="color: var(--secondary);"></i>
                                <span>Puede repararse fácilmente</span>
                            </div>
                        </div>
                    </div>
                    <div class="example-box good">
                        <strong><i class="fas fa-drafting-compass"></i> EJEMPLO DE PROPUESTA</strong>
                        <strong>Diseño:</strong> Sistema de riego por goteo con botellas PET<br><br>
                        <strong>Materiales:</strong> 10 botellas de 2L, cinta adhesiva, alfileres, tijeras, marcador<br><br>
                        <strong>Funcionamiento:</strong> Las botellas se llenan de agua y se colocan invertidas junto a las plantas. El agua gotea lentamente manteniendo la humedad.<br><br>
                        <strong>Criterios de éxito:</strong> 
                        • Mantiene la tierra húmeda por 3 días sin recarga<br>
                        • No desperdicia agua (sin fugas)<br>
                        • Fácil de recargar por los estudiantes
                    </div>
                    <div class="tools-box">
                        <h4><i class="fas fa-exclamation-triangle"></i> Errores comunes</h4>
                        <ul>
                            <li>Diseños demasiado complejos para el tiempo disponible</li>
                            <li>No considerar quién mantendrá la solución después</li>
                            <li>Olvidar medidas de seguridad (bordes filosos, toxicidad)</li>
                            <li>No probar con materiales similares antes de construir</li>
                        </ul>
                    </div>
                `
            },
            {
                num: 4, title: "Construcción y Prueba", subtitle: "Del plan a la realidad",
                content: `
                    <div class="step-section">
                        <h4><i class="fas fa-hammer"></i> Construcción</h4>
                        <p>Seguir el plan pero estar abierto a ajustes. Documentar el proceso con fotos o video.</p>
                        <ul class="checklist">
                            <li><i class="fas fa-check"></i> <div>Trabajo organizado: roles definidos si es grupal</div></li>
                            <li><i class="fas fa-check"></i> <div>Uso seguro de herramientas (tijeras, cuchillos, taladros manuales)</div></li>
                            <li><i class="fas fa-check"></i> <div>Registro de problemas surgidos y soluciones</div></li>
                        </ul>
                    </div>
                    <div class="step-section">
                        <h4><i class="fas fa-vial"></i> Prueba y registro</h4>
                        <p>Probar el prototipo bajo condiciones reales y registrar datos objetivos.</p>
                        <div style="padding: 1rem; background: #faf5ff; border-radius: 0.5rem; margin-bottom: 1rem;">
                            <strong style="color: var(--purple);">Ejemplo de prueba para riego:</strong>
                            <ul style="margin: 0.5rem 0 0 1.25rem;">
                                <li>¿Cuánto tiempo tarda en vaciarse la botella?</li>
                                <li>¿Alcanza el agua a la planta?</li>
                                <li>¿Se mantiene estable el sistema?</li>
                                <li>¿Qué pasa si llueve?</li>
                            </ul>
                        </div>
                    </div>
                    <div class="example-box good">
                        <strong><i class="fas fa-clipboard"></i> REGISTRO DE PRUEBA</strong>
                        <table style="width: 100%; margin-top: 0.5rem; font-size: 0.875rem; border-collapse: collapse;">
                            <tr style="background: #f3e8ff;">
                                <th style="padding: 0.5rem; border: 1px solid #d8b4fe;">Aspecto evaluado</th>
                                <th style="padding: 0.5rem; border: 1px solid #d8b4fe;">Resultado</th>
                                <th style="padding: 0.5rem; border: 1px solid #d8b4fe;">¿Cumple?</th>
                            </tr>
                            <tr>
                                <td style="padding: 0.5rem; border: 1px solid #e9d5ff;">Duración del riego</td>
                                <td style="padding: 0.5rem; border: 1px solid #e9d5ff;">2 días</td>
                                <td style="padding: 0.5rem; border: 1px solid #e9d5ff;">No (objetivo: 3 días)</td>
                            </tr>
                            <tr>
                                <td style="padding: 0.5rem; border: 1px solid #e9d5ff;">Estabilidad</td>
                                <td style="padding: 0.5rem; border: 1px solid #e9d5ff;">Se cae con viento</td>
                                <td style="padding: 0.5rem; border: 1px solid #e9d5ff;">No</td>
                            </tr>
                        </table>
                    </div>
                `
            },
            {
                num: 5, title: "Evaluación y Mejora", subtitle: "¿Funciona? ¿Cómo mejorarlo?",
                content: `
                    <div class="step-section">
                        <h4><i class="fas fa-chart-bar"></i> Evaluación del diseño</h4>
                        <p>Comparar los resultados con los criterios de éxito definidos. Ser honestos sobre limitaciones.</p>
                        <div style="display: grid; gap: 0.75rem; margin-bottom: 1rem;">
                            <div style="padding: 1rem; background: #f0fdf4; border-radius: 0.5rem; border-left: 4px solid var(--secondary);">
                                <strong style="color: var(--secondary);"><i class="fas fa-check-circle"></i> ¿Qué funcionó bien?</strong>
                                <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem;">Identificar fortalezas del diseño</p>
                            </div>
                            <div style="padding: 1rem; background: #fef2f2; border-radius: 0.5rem; border-left: 4px solid var(--danger);">
                                <strong style="color: var(--danger);"><i class="fas fa-times-circle"></i> ¿Qué no funcionó?</strong>
                                <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem;">Problemas detectados (no son fracasos, son aprendizajes)</p>
                            </div>
                            <div style="padding: 1rem; background: #eff6ff; border-radius: 0.5rem; border-left: 4px solid var(--primary);">
                                <strong style="color: var(--primary);"><i class="fas fa-lightbulb"></i> ¿Qué mejorar?</strong>
                                <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem;">Propuestas concretas de mejora</p>
                            </div>
                        </div>
                    </div>
                    <div class="step-section">
                        <h4><i class="fas fa-redo"></i> Iteración</h4>
                        <p>El diseño tecnológico es cíclico. Las mejoras se implementan y se prueba de nuevo.</p>
                    </div>
                    <div class="example-box good">
                        <strong><i class="fas fa-clipboard-check"></i> EVALUACIÓN COMPLETA</strong>
                        <strong>Diseño:</strong> Sistema de riego con botellas<br><br>
                        <strong>Resultados vs. criterios:</strong><br>
                        • Duración: 2 días (objetivo: 3) → <strong>No cumple</strong><br>
                        • Estabilidad: Se cae con viento → <strong>No cumple</strong><br>
                        • Fácil recarga: Sí → <strong>Cumple</strong><br><br>
                        <strong>Mejoras propuestas:</strong><br>
                        • Hacer agujeros más pequeños para que dure más<br>
                        • Enterrar parcialmente la botella para estabilidad<br>
                        • Probar con botellas de 3L en lugar de 2L
                    </div>
                    <div class="tools-box">
                        <h4><i class="fas fa-users"></i> Socialización</h4>
                        <p>Comunicar el diseño a otros para que pueda replicarse:</p>
                        <ul>
                            <li><strong>Manual de uso:</strong> Cómo operar y mantener la solución</li>
                            <li><strong>Cartel explicativo:</strong> Para la comunidad escolar</li>
                            <li><strong>Video demostrativo:</strong> Si hay recursos tecnológicos</li>
                        </ul>
                    </div>
                `
            }
        ];

        // ==================== RENDERIZAR GUÍAS ====================
        function renderIndagacionSteps() {
            const container = document.getElementById('indagacionSteps');
            container.innerHTML = indagacionSteps.map((step, index) => `
                <div class="step-card ${index === 0 ? 'expanded' : ''}" onclick="toggleStep(this)">
                    <div class="step-header">
                        <div class="step-number">${step.num}</div>
                        <div class="step-title">
                            <h3>${step.title}</h3>
                            <p>${step.subtitle}</p>
                        </div>
                        <i class="fas fa-chevron-down step-toggle"></i>
                    </div>
                    <div class="step-content">
                        <div class="step-body">
                            ${step.content}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderDisenoSteps() {
            const container = document.getElementById('disenoSteps');
            container.innerHTML = disenoSteps.map((step, index) => `
                <div class="step-card diseno ${index === 0 ? 'expanded' : ''}" onclick="toggleStep(this)">
                    <div class="step-header">
                        <div class="step-number">${step.num}</div>
                        <div class="step-title">
                            <h3>${step.title}</h3>
                            <p>${step.subtitle}</p>
                        </div>
                        <i class="fas fa-chevron-down step-toggle"></i>
                    </div>
                    <div class="step-content">
                        <div class="step-body">
                            ${step.content}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function toggleStep(card) {
            card.classList.toggle('expanded');
        }

        function switchGuide(guide) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            document.querySelectorAll('.guide-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`guide-${guide}`).classList.add('active');
        }

        // ==================== EVALUACIÓN: TABS Y CALCULADORA ====================
        function switchEvalTab(tabId, btn) {
            // Desactivar todos los tabs y contenidos
            document.querySelectorAll('.eval-tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.eval-content').forEach(c => c.classList.remove('active'));
            
            // Activar el seleccionado
            btn.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        function calcularNotaIndagacion() {
            const selects = document.querySelectorAll('#rubrica-indagacion select');
            let suma = 0;
            selects.forEach(select => {
                suma += parseInt(select.value);
            });
            const promedio = (suma / selects.length).toFixed(1);
            document.getElementById('promedio-indagacion').textContent = promedio;
        }

        function downloadTemplate(type) {
            const templates = {
                indagacion: 'Plantilla_Indagacion_Cientifica.docx',
                diseno: 'Plantilla_Diseno_Tecnologico.docx'
            };
            alert(`Descargando: ${templates[type]}\n\nEn una implementación real, esto descargaría el archivo editable.`);
        }

        // ==================== SECUENCIAS ====================
        let currentGradeFilter = 'all';
        let currentSearch = '';

        function renderSequences() {
            const grid = document.getElementById('sequencesGrid');
            let filtered = sequences.filter(seq => {
                const matchGrade = currentGradeFilter === 'all' || seq.grade.includes(currentGradeFilter);
                const matchSearch = currentSearch === '' || 
                    seq.title.toLowerCase().includes(currentSearch.toLowerCase()) ||
                    seq.description.toLowerCase().includes(currentSearch.toLowerCase());
                return matchGrade && matchSearch;
            });
            
            document.getElementById('resultsCount').textContent = 
                `Mostrando ${filtered.length} de ${sequences.length} secuencias`;
            
            if (filtered.length === 0) {
                grid.innerHTML = `<div class="empty-state" style="grid-column: 1/-1;"><i class="fas fa-search"></i><h3>No se encontraron secuencias</h3></div>`;
                return;
            }
            
            grid.innerHTML = filtered.map(seq => `
                <div class="card" onclick="openSequenceDetail(${seq.id})">
                    <div class="card-image">
                        <i class="fas fa-book-open"></i>
                        <div class="card-badge"><i class="fas fa-check-circle" style="color: var(--secondary);"></i> Validada</div>
                    </div>
                    <div class="card-body">
                        <span class="card-tag tag-${seq.tags[0]}">${seq.area}</span>
                        <h3>${seq.title}</h3>
                        <p>${seq.description}</p>
                        <div class="card-meta">
                            <span><i class="fas fa-graduation-cap"></i> ${seq.grade}</span>
                            <span><i class="fas fa-clock"></i> ${seq.duration}</span>
                        </div>
                    </div>
                    <div class="card-footer">
                        <button class="btn btn-outline" onclick="event.stopPropagation(); openSequenceDetail(${seq.id})">
                            <i class="fas fa-eye"></i> Ver
                        </button>
                        <button class="btn btn-primary" onclick="event.stopPropagation(); alert('Descargando...')">
                            <i class="fas fa-download"></i> Descargar
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function filterSequences() {
            currentSearch = document.getElementById('searchInput').value;
            renderSequences();
        }

        function filterByGrade(grade) {
            currentGradeFilter = grade;
            document.querySelectorAll('[id^="filter-grade-"]').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`filter-grade-${grade === 'all' ? 'all' : grade.replace('°', '')}`).classList.add('active');
            renderSequences();
        }

        function openSequenceDetail(id) {
            const seq = sequences.find(s => s.id === id);
            openModal('sequence-detail');
            document.getElementById('modalTitle').textContent = seq.title;
            document.getElementById('modalBody').innerHTML = `
                <div class="sequence-detail-meta">
                    <div class="meta-item"><i class="fas fa-graduation-cap"></i><div class="label">Grado</div><div class="value">${seq.grade}</div></div>
                    <div class="meta-item"><i class="fas fa-clock"></i><div class="label">Duración</div><div class="value">${seq.duration}</div></div>
                    <div class="meta-item"><i class="fas fa-map-marker-alt"></i><div class="label">Contexto</div><div class="value">${seq.context}</div></div>
                </div>
                <p>${seq.description}</p>
                <div style="margin-top: 1.5rem;">
                    <button class="btn btn-primary" onclick="alert('Descargando secuencia...')" style="width: 100%;">
                        <i class="fas fa-download"></i> Descargar secuencia completa
                    </button>
                </div>
            `;
        }

        // ==================== FIREBASE Y MODALES ====================
        function loadQuestions() {
            const loadingDiv = document.getElementById('loadingQuestions');
            const listDiv = document.getElementById('questionsList');
            
            db.collection('questions').orderBy('timestamp', 'desc').limit(10).get()
                .then(snapshot => {
                    loadingDiv.style.display = 'none';
                    listDiv.style.display = 'flex';
                    
                    if (snapshot.empty) {
                        listDiv.innerHTML = '<div class="empty-state"><i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 1rem;"></i><p>No hay consultas aún.</p></div>';
                        return;
                    }
                    
                    listDiv.innerHTML = snapshot.docs.map(doc => {
                        const data = doc.data();
                        const date = data.timestamp ? data.timestamp.toDate().toLocaleDateString('es-ES') : 'Reciente';
                        const initials = data.author ? data.author.substring(0, 2).toUpperCase() : 'AN';
                        const isAnswered = data.answered;
                        
                        return `
                            <div class="discussion-item ${isAnswered ? '' : 'pending'}" onclick="openQuestionDetail('${doc.id}')">
                                <div class="discussion-avatar ${isAnswered ? '' : 'pending'}">${initials}</div>
                                <div class="discussion-content">
                                    <h4>${data.title}</h4>
                                    <p>${data.content.substring(0, 100)}${data.content.length > 100 ? '...' : ''}</p>
                                    <div class="discussion-meta">
                                        <span><i class="fas fa-user"></i> ${data.author}</span>
                                        <span><i class="fas fa-clock"></i> ${date}</span>
                                        ${isAnswered ? '<span style="color: var(--secondary);"><i class="fas fa-check-circle"></i> Respondido</span>' : '<span style="color: var(--accent);"><i class="fas fa-clock"></i> Pendiente</span>'}
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                })
                .catch(error => {
                    console.error("Error:", error);
                    loadingDiv.innerHTML = '<p style="color: #dc2626;">Error al cargar.</p>';
                });
        }

        function openQuestionDetail(id) {
            db.collection('questions').doc(id).get().then(doc => {
                const data = doc.data();
                openModal('question-detail');
                document.getElementById('modalTitle').textContent = 'Consulta y Respuesta';
                
                const date = data.timestamp ? data.timestamp.toDate().toLocaleString('es-ES') : 'Fecha no disponible';
                const responseDate = data.responseDate ? data.responseDate.toDate().toLocaleString('es-ES') : 'Fecha no disponible';
                
                document.getElementById('modalBody').innerHTML = `
                    <div style="margin-bottom: 1.5rem;">
                        <h3 style="margin-bottom: 0.5rem;">${data.title}</h3>
                        <div class="discussion-meta" style="margin-bottom: 1rem;">
                            <span><i class="fas fa-user"></i> ${data.author}</span>
                            <span><i class="fas fa-graduation-cap"></i> ${data.grade}</span>
                            <span><i class="fas fa-clock"></i> ${date}</span>
                        </div>
                    </div>
                    <div style="background: var(--bg); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1.5rem;">
                        <h4 style="margin-bottom: 0.5rem; color: var(--text-light); font-size: 0.875rem;">Consulta:</h4>
                        <p style="margin: 0;">${data.content}</p>
                    </div>
                    ${data.answered ? `
                        <div style="background: #f0fdf4; padding: 1.5rem; border-radius: 0.5rem; border-left: 4px solid var(--secondary);">
                            <h4 style="margin-bottom: 0.75rem; color: var(--secondary);"><i class="fas fa-reply"></i> Respuesta del Especialista</h4>
                            <p style="margin-bottom: 1rem;">${data.response || 'Sin texto'}</p>
                            <small style="color: var(--text-light);"><i class="fas fa-clock"></i> ${responseDate}</small>
                        </div>
                    ` : '<div style="background: #fef3c7; padding: 1rem; border-radius: 0.5rem; text-align: center;"><p>Consulta pendiente de respuesta.</p></div>'}
                `;
            });
        }

        function submitQuestion(e) {
            e.preventDefault();
            const form = e.target;
            const submitBtn = form.querySelector('button[type="submit"]');
            submitBtn.innerHTML = '<div class="loading" style="width: 16px; height: 16px; border-width: 2px; margin-right: 0.5rem;"></div> Enviando...';
            submitBtn.disabled = true;
            
            db.collection('questions').add({
                title: form.title.value,
                content: form.content.value,
                type: form.type.value,
                author: form.author.value || 'Anónimo',
                grade: form.grade.value,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                answered: false
            }).then(() => {
                form.reset();
                closeModal();
                alert('¡Consulta enviada!');
                loadQuestions();
            }).catch(error => {
                alert('Error: ' + error.message);
                submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Enviar';
                submitBtn.disabled = false;
            });
        }

        function openModal(type) {
            const modal = document.getElementById('modal');
            const title = document.getElementById('modalTitle');
            const body = document.getElementById('modalBody');
            modal.classList.add('active');
            
            if (type === 'new-question') {
                title.textContent = 'Nueva Consulta';
                body.innerHTML = `
                    <form onsubmit="submitQuestion(event)">
                        <label>Título:</label>
                        <input type="text" name="title" placeholder="Ej: ¿Cómo evaluar...?" required>
                        <label>Descripción:</label>
                        <textarea name="content" rows="4" required></textarea>
                        <label>Tu nombre:</label>
                        <input type="text" name="author" placeholder="Prof. Juan Pérez">
                        <label>Grado:</label>
                        <select name="grade" required>
                            <option value="">Selecciona...</option>
                            <option value="1° Secundaria">1° Secundaria</option>
                            <option value="2° Secundaria">2° Secundaria</option>
                            <option value="3° Secundaria">3° Secundaria</option>
                            <option value="4° Secundaria">4° Secundaria</option>
                            <option value="5° Secundaria">5° Secundaria</option>
                        </select>
                        <label>Tipo:</label>
                        <select name="type" required>
                            <option value="Diseño de sesión">Diseño de sesión</option>
                            <option value="Evaluación">Evaluación</option>
                            <option value="Indagación">Indagación</option>
                            <option value="Recursos">Recursos</option>
                        </select>
                        <button type="submit" class="btn btn-primary" style="width: 100%;"><i class="fas fa-paper-plane"></i> Enviar</button>
                    </form>
                `;
            }
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        function scrollToSection(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
        }

        function toggleMobileMenu() {
            alert('Usa navegación inferior en móvil');
        }

        // ==================== INICIALIZACIÓN ====================
        document.addEventListener('DOMContentLoaded', () => {
            renderSequences();
            renderIndagacionSteps();
            renderDisenoSteps();
            loadQuestions();
            
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) target.scrollIntoView({ behavior: 'smooth' });
                });
            });
        });

        window.onclick = function(event) {
            const modal = document.getElementById('modal');
            if (event.target === modal) closeModal();
        }
    </script>
</body>
</html>
